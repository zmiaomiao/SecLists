<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <title>Page not found</title>
        <meta name=”googlebot” content=”NOODP” />
        <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
                <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600,400italic,600italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
        <link rel="icon" href="https://static.webyog.com/favicon.ico" type="image/x-icon"/>
        <link rel="shortcut icon" href="https://static.webyog.com/favicon.ico" type="image/x-icon"/>
        <link rel="stylesheet" href="https://static.webyog.com/min/g=master-css&v=242"/>
                <!--[if IE 7]>
            <link rel="stylesheet" type="text/css" href="https://static.webyog.com/css/ie7.css?version=242" />
        <![endif]-->
        <!--[if IE 8]>
            <link rel="stylesheet" type="text/css" href="https://static.webyog.com/css/ie8.css?version=242" />
        <![endif]-->
        <!--[if gt IE 7]>
            <link rel="stylesheet" type="text/css" href="https://static.webyog.com/css/ie8-and-up.css" />
        <![endif]-->
        <script type="text/javascript" src="https://static.webyog.com/min/f=/js/jquery.1.7.js&v=242"></script>
        <script type="text/javascript" src="https://static.webyog.com/min/f=/js/jquery.cookie.js&v=242"></script>
            </head>
    <body class="wy-body">
        <div class="wy-main-wrapper">
            <div id="wy-banner-wrapper" style="display: none;">
    <div class="wy-container">
        <a id="banner-link" href="/shop">
            <div id="banner-left" class="wy-left">
                <div class="wy-left">
                    <span class="wy-font-size-26 full-height wy-white">
                        Year End Sale - <span class="wy-big-text">FLAT 25% OFF</span> on all products
                    </span>
                </div>
            </div>
        </a>
        <div class="wy-right wy-center-text">
            <div id="coupon-code">
                <span class="full-height wy-coupon-text-color wy-font-level-3">
                    Coupon code: <span class="wy-bold wy-coupon-text-color wy-cursor-pointer">BYE14</span>
                </span>
            </div>
            <div class="wy-font-level-3 wy-right wy-white">
                <span class="wy-white" style="padding-right: 4px;">
                    Hurry up, offer expires soon!
                </span>
            </div>
        </div>
    </div>
</div>
   
<div id="wy-header-wrapper">
    <div class="wy-container">
        <div id="wy-logo" class="wy-left">
            <a href="/"><img src="https://static.webyog.com/images/webyog-logo.png?v=2" alt='webyog logo' /></a>
        </div>
        <div class="wy-right wy-restrict-width">
            <div>
                <div class="wy-left minicart-section wy-minicart-section">
                    <div class="wy-left wy-font-level-3 minicart-section-inner">
                        <a class="wy-link-color" id="my-minicart">
                            <span class="cm-icons" id="wy-cart-icon"></span>
                            <div class="wy-font-level-3" id="minicart">Cart</div>
                            <div class="wy-font-level-3" id="minicart_brackets">(<span id="minicart_count"></span>)</div>
                        </a>
                    </div>
                    <span class="wy-img-button" id="tooltip-arrow"></span>
                    <div id="tooltip-content">
                        <table id='minicart-product-list' width='100%' class='wy-font-level-3' cellspacing=10>
                        </table>
                        <div class="wy-clear wy-right"><a id="view-cart" href="#shopping-cart-container" class="cboxElement"><div id='view-cart-span' class='wy-white wy-button wy-center-text wy-checkout-button'>View cart</div></a></div>                   </div>
                </div>

                <div id="wy-webyog-search">
                    <form action="/webyog/search" id="cse-search-box">

                        <input type="hidden" name="cx" value="004508359561450295238:famli6ynmy0" />
                        <input type="hidden" name="cof" value="FORID:10" />
                        <input type="hidden" name="ie" value="UTF-8" />

            <!--<input type="text" name="q" size="31" />-->

                        <input id="search" type="text" name="q" class="wy-search-box wy-user-actionable wy-right" size="35" />
                        <a href="javascript:"><span class="wy-search-box-icon wy-right"></span></a>
                    </form>
                </div>
            </div>
            <div class="wy-link-list wy-right wy-font-level-3">
                <ul id="dropdown-menu">
                    <li>
                        <a id="home" href="/">Home</a>
                    </li>
                    <li class="wy-old-visitors-tab">
                        <a id="products" href="" onclick="return false;">Products</a>
                        <ul>
                            <li><a href="/product/sqlyog">SQLyog</a></li>
                            <li><a href="/product/monyog">MONyog</a></li>
                        </ul>
                    </li>
                    <li>
                        <a id="shop" href="/shop">Shop</a>
                    </li>
                    <li>
                        <a id="downloads" href="/product/downloads">Download Trials</a>
                    </li>
                    <li>
                        <a id="customer-login" href="/customer">Customer Login</a>
                    </li>
                    <li>
                        <a id="community" href="http://forums.webyog.com" target="_blank">Community</a>
                    </li>
                    <li class="zero-right-margin-right-padding dropmenu_last_child_margin">
                        <a id="blog" href="http://blog.webyog.com"  target="_blank" class="zero-right-margin-right-padding">Blog</a>
                    </li>
                </ul>
            </div>

        </div>

    </div>
</div>

<script type="text/javascript">
    var showUnderlinedBanner = true;
    //timer-banner relate code   
    var bannerExpiryDate = '12/01/2014 23:59:59';
    $(document).ready(function() {
        //Donot uncomment below code 
        //$("#coupon-code").text(Math.round(new Date().getTime() / 1000));
        $(".wy-search-box-icon").click(function() {
            if ($("#search").val() == "") {

            } else {
                $(this).parents('form').submit();
            }
        });
        //console.log($("#banner-discount-timer").width());
        //timer-banner relate code 
//       $('.countdown').downCount({
//            date: bannerExpiryDate,
//            offset: -8
//        }, function() {
//            //alert('WOOT WOOT, done!');
//            $('#wy-banner-wrapper').hide();//commented
//        });

//        $("#banner-link").hover(function() {
//            if (showUnderlinedBanner) {
//                //$("#banner-left").find('span').addClass("white-underline");
//                $("#banner-link").addClass("white-underline");
//            }
//        }, function() {
//            if (showUnderlinedBanner) {
//                //$("#banner-left").find('span').removeClass("white-underline");
//                $("#banner-link").removeClass("white-underline");
//            }
//        });
        $("#wy-webyog-search #search").keydown(function(event) {
            //alert(event.which); return;
            if (event.which == 13) {
                if ($("#search").val() == "") {
                    return false;
                } else {
                    $("#wy-webyog-search #search").parents('form').submit();
                    e.preventDefault();
                }
            }

        });

        var pattern = / *(\/shop)/;

        if (pattern.test(window.location.href)) {
            $("#banner-link").attr("href", "javascript:return false;")
                    .css("cursor", "default");
            showUnderlinedBanner = false;
        }
    });
</script>
            <div class="wy-content-wrapper">
                <div class="wy-product-logo-wrapper">
    <div class="wy-container wy-white wy-white wy-product-logo-description wy-font-level-1">
        Page not found    </div>
</div>

<div class="wy-wrapper wy-extra-margins">
    <div class="wy-container wy-inner-page-background wy-min-container-height">
        <div class="wy-inner-full-container wy-extra-margins">
            <div class="wy-inner-third wy-left wy-extra-margins wy-right-text">
                <img src="https://static.webyog.com/images/error.png">
            </div>
            <div class="wy-left wy-font-level-1 wy-inner-half wy-extra-margins wy-default-left-right-margin wy-bold wy-error-message-div">
                Oops. That page doesn't exist. Go to <a href='/'>home page</a>.                <div class="wy-font-level-2 wy-small-top-margin">
                    <a href="/">Click here</a> to go to the home page
                </div>
            </div>
        </div>
    </div>
</div>
            </div>
            <!--
<div id="olark-data"><a class="olark-key" id="olark-5962-702-10-7739" title="Powered by Olark" href="http://olark.com/about" rel="nofollow">Powered by Olark</a></div>
Obsolete way of doing things
-->
<div class="livehelp-contactus-panel" id="livehelp-contactus-panel"></div>

<div id="email-form-container" style="display:none" class="wy-font-level-2 wy-extra-left-right-padding">
    <form method="post" class="wy-font-level-3">
        <div id="sales-email-send-div" class="wy-bottom-margin">
            <div class="wy-clear wy-font-level-3 wy-top-margin "> 
                       Just fill in the details and we'll get in touch!              </div>
            <div class="wy-clear wy-small-top-margin">
               <!--
                <div class="wy-left heading wy-font-level-3">
                    <input type="text" id="name" name="name" value="name" ></input>
                </div>
                <div class="wy-right wy-left wy-font-level-3">
                    <input type="text" id="reply-email" name="replyemail" value="email"></input>
                </div>
               -->
               <div class="wy-left wy-font-level-3">
                    <input  class="personal" type="text" id="reply-email" name="replyemail" value="email"></input>
                </div>
            </div>
            <div class="wy-clear"></div>
         <!--  <div class="wy-small-top-margin wy-font-level-3">
                <input type="text" class ="personal" id="subject" name="subject" value="subject"></input>
            </div>
         Goes to bottom and gets hidden
         -->
            <div class="wy-small-top-margin wy-font-level-3">
                <textarea class="personal wy-font-level-3" name="message" id="message" name="message"></textarea>
            </div>
            <div id="want-to-work-with-us-link" class="wy-clear wy-font-level-3 wy-left wy-top-margin ">
                <a class="underlined" href="/webyog/careers">Want to work with us?</a>
            </div>
            <input type="hidden" id="emailType" value=""></input>   
            <input type="hidden" id="product" value=""></input>   
             <input type="hidden" id="subject" name="subject" value=""></input>
            <div>
                <div class="wy-small-top-margin wy-small-bottom-margin wy-font-level-2 wy-middle wy-right">
                    <a href="javascript:void(0)" onclick="validateSalesForm()" class="wy-green" style="text-decoration:none;">
                        <div class="wy-button wy-green wy-white-border wy-right wy-center-text wy-font-level-3">Submit</div>
                    </a>
                </div>
            </div>
             <div class="wy-clear wy-left wy-really-small-negative-top-margin">
                 <div id="sales-email-error" class="wy-font-level-3 wy-red">
                 </div>
            </div>
        </div>
        <div id="sales-message-div">
            <div class="wy-default-left-right-padding">
                <div class="wy-left">
                    <span class="wy-img-button big-tick">
                    </span>
                </div>
                <div id="data-div" class="wy-left wy-top-margin wy-bottom-margin">
                    <div class="response wy-really-really-small-top-margin wy-bold">
                    </div>
                </div>
            </div>
            <div id="video-div" class="wy-clear wy-top-margin wy-center-text wy-bold wy-font-level-2">
                <span id="sqlyog-testimonial-heading" style="display:none;">
                    
What are users saying about SQLyog?                </span>
                <span id="monyog-testimonial-heading" style="display:none;">
                    What's new in MONyog?                </span>
                <div id="preview" onclick="showVideo();" style="display:none;">
                    <img src="" width="500" height="311" />                        
                </div>
                <div id="video" style="display:none">
                    <iframe width="500" height="311" src="" frameborder="0" allowfullscreen></iframe>
                </div>
            </div>
        </div>
    </form>
    <div class="ajax-spinner">
        <img src="https://static.webyog.com/images/ajax-loader.gif" height="32" width="32" alt="">
    </div>
</div>

<script type="text/javascript">
    var emailFormVideoURL = "";
    
    $(document).ready(function() {
        $("#email-form-container #reply-email").watermark("Email",{className:"wy-watermark", useNative:false});
        //$("#email-form-container #name").watermark("Name",{className:"wy-watermark", useNative:false});
        //$("#email-form-container #subject").watermark("Subject",{className:"wy-watermark", useNative:false});
        $("#email-form-container #message").watermark("Message",{className:"wy-watermark", useNative:false});
        $("#email-form-container #reply-email").keydown(function(event) {
            if ( event.which == 13 ) {
                validateSalesForm();
                return false;
            }
        });
    });
    function showVideo(){
        $("#email-form-container #preview").hide(); 
        $("#email-form-container #video").show().find("iframe").attr("src",emailFormVideoURL);
    }
    
    /*
     * A function to set the parameters for the email form - hidden form fields, videos, headning and preview images. Called on 
     * the click event of anchors of 3 varieties:
     * 
     * 1. SQLyog - i) contact us everywhere on footer, ii) contact support on customer area
     * 2. MONyog - i) monyog page, ii) shop page
     * 3. Visifire - i) contact visifire support on customer area
     * 
     * Parameters:
     * 
     * @productName: the product for which the form is invoked. SQLyog by default.
     * @emailType: sales or support.
     * 
     * Returns:
     * 
     * Nothing
     * 
     * Preconditions:
     * 
     * None
     * 
     * Postconditions:
     * 
     * 1. The hidden input field values are set to the params passed.
     * 2. The video iframe source is set.
     * 3..The preview image is set.
     * 4. The title span corresponding to the product name is shown.
     *
     */
    /*  setting By-Default subject as per the  product
     *  1. for monyog: MONyog Sales Query---> and again it should go to sales@webyog.com
     *  2. for sqlyog and contact-us button : Webyog Support----> should go to support@webyog.com
     *  3. for visifire: Visifire Support ---> should goto support@webyog.com
     *
     *  */
     
    function setEmailFormParameters(productName, emailType){
        //Set the emailType hidden form field
        $("#email-form-container #emailType").val(emailType);
        //Set the product hidden form field
        $("#email-form-container #product").val(productName);
        
        
    
        //Take different actions based on the product names
        if(productName=='SQLyog'){
            // set the subject for contact-us button and customer area support button
            $("#email-form-container #subject").val("Webyog Support");
            $("#email-form-container #video-div").show();
            emailFormVideoURL = "https://youtube.com/embed/M8BM1aMFfeY?rel=0&wmode=transparent&fs=1&autoplay=1"
            $("#email-form-container #preview").show().find("img").attr("src","https://static.webyog.com/images/testimonials/rob-rosamond-sqlyog-testimonial.png");
            
            //Show the appropriate heading
            $("#monyog-testimonial-heading").hide();
            $("#sqlyog-testimonial-heading").show();
           
        } else if(productName=='MONyog'){
           // set the subject for Monypg sales button situated on price table of monyog
           $("#email-form-container #subject").val("MONyog Sales Query");
            $("#email-form-container #video-div").show();
            emailFormVideoURL = "https://youtube.com/embed/wi-EeudUL-c?rel=0&wmode=transparent&fs=1&autoplay=1";
            $("#email-form-container #preview").show().find("img").attr("src","https://static.webyog.com/images/monyog-realtime-video-thumbnail.png");
            
            //Show the appropriate heading
            $("#sqlyog-testimonial-heading").hide();
            $("#monyog-testimonial-heading").show();
            
            
        } else{
           // set the subject for the visifire support button in customer area.
           $("#email-form-container #subject").val("Visifire Support");
           
            $("#email-form-container #video-div").hide();
            
            $("#sqlyog-testimonial-heading").hide();
            $("#monyog-testimonial-heading").hide();
        }
    }
</script>

<div id="wy-footer-wrapper" class="wy-wrapper">
    <div class="wy-container wy-font-level-4 wy-small-top-margin">
        <div class="wy-left">
            Contact Sales: <a href="mailto:sales@webyog.com">sales@webyog.com</a>, +1 408-890-2524 (US), +44-020-3743-9384 (EU)

        </div>
        <div class="wy-right">
            <a href="/webyog/aboutUs">About us</a>&nbsp;|&nbsp;<a href="/customer">Customer Login</a>&nbsp;|&nbsp;<a href="/eula">EULA</a>
        </div>
    </div>
    <div class="wy-container wy-font-level-4 wy-really-small-top-margin wy-small-bottom-margin">
        <blockquote>
            <div class="wy-left">
                GUI, Front End, Admin, Visual Designer, Monitoring, Performance Tuning Tools for MySQL
            </div>
            <div class="wy-right">
                <a href="/webyog/resellers">Resellers</a>&nbsp;|&nbsp;<a href="/eula/privacyPolicy">Privacy Policy</a>&nbsp;|&nbsp;<a href="/webyog/careers">Careers</a>
            </div>
        </blockquote>
    </div>
</div>

<div id="shopping-cart-container" style="display:none" >
            <div class="wy-product-download-tab wy-inner-inner-tab">
            <div id="shopping-cart-header-bar" class="wy-product-download-label wy-font-level-3 wy-white">
                <div class="wy-default-left-right-padding">
                    <span class="cm-icons" id="circle1-icon">&nbsp;</span>
                    <span class="wy-product-download-label-text">
                        Choose upgrades
                    </span>
                </div>
            </div>
        </div>
        <div id="shopping-form" class="wy-product-download-tab wy-top-margin" style="display:none; ">
            <div>
                <div class="multiyear-block">
                    <div class="wy-bottom-margin multiyear-text">
                        <span class="wy-img-button feature-present"></span>
                        Product added to the cart.
                    </div>
                    <ul class="purchase-type">
                        <li>
                            <input type="radio" name="upgrade" value="1">
                            Upgrades, Bug fixes and Patches for 1 year (included with your purchase)
                        </li>
                        <li>
                            <input type="radio" name="upgrade" value="2">
                            Upgrades, Bug fixes and Patches for 2 years <span class="wy-bold">[add $<span id="2yearPurchaseAmount"></span>]</span>
                        </li>
                        <li id="life-multiyear" style="display:none;">
                            <input type="radio" name="upgrade" value="3">
                            Upgrades, Bug fixes and Patches for 5 years <span class="wy-bold">[add $<span id="lifePurchaseAmount"></span>]</span>
                        </li>
                    </ul>
                </div>
                <div class="cart-block">
                    <ul>
                        <li id="productnameblock">
                            <span class="item-added-name"></span>
                        </li>
                        <li>
                            <span id="cart-subtotal-block">
                                <span class="total-text">Subtotal</span>
                                &nbsp;
                                <span class="wy-bold wy-usd-size">$</span><span class="total-value">ok</span>
                            </span>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="wy-clear wy-right wy-top-margin wy-bottom-margin cart-buttons-block">
                <input id="continue_button" class="wy-button wy-font-level-3" type="button" value="Continue shopping"/>
                <input id="proceed_checkout_button" class="wy-button wy-font-level-3 wy-green" type="button" value="Proceed to checkout"/>
            </div>
        </div>
    
    <div id="checkout-header-bar" class="wy-clear wy-product-download-tab wy-grey-force wy-inner-inner-tab wy-white">
        <div class="wy-product-download-label wy-font-level-3">
            <div class="wy-default-left-right-padding">
                <span class="cm-icons" id="circle2-icon">&nbsp;</span>
                <span class="wy-product-download-label-text">
                    Review order and checkout
                </span>
            </div>
        </div>
    </div>
    <div id="checkout-form" class="wy-product-download-tab wy-default-left-right-padding wy-bottom-margin" style="margin-bottom: 20px;">
        <div id="finalShoppingCart"></div>
        <div id="emptyShoppingCart">
            <table width="95%" class="wy-default-left-right-padding wy-font-level-3 wy-top-margin">
                <tr>
                    <td align="center">
                        <div style="line-height: 50px;" class="wy-font-level-1">Your cart is empty</div>
                    </td>
                </tr>
                <tr>
                    <td align="center">
                        <div class="wy-font-level-3 wy-top-margin" style="width:250px;">
                            <input id="emptyCartButton" type="button" class="wy-button wy-font-level-3" value="Continue shopping" />
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div id="emptycartmsg" style="display:none;">
                            <a href='/shop'>click here</a>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <table cellpadding="0" cellspacing="0" id="checkout-customer-info" style="display:none;" width="920px" class="wy-default-left-right-padding wy-font-level-3">
            <tr>
                <td>
                    <input type="text" id="purchase_email" name="purchase_email" placeholder="Email (required)" maxlength="100" value="" >
                </td>
                <td style="padding-bottom: 25px;">
                    <span id='email_error' class='wy-red wy-clear'></span>
                </td>
            </tr>
            <tr>
                <td>
                    <input type="text" id="reg_name" name="regname" maxlength="100" placeholder="Registered to (required)"  value="">
                </td>
                <td>
                    <span id='regname_error' class='wy-red wy-clear'></span>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="wy-clear wy-font-level-4 wy-multiyear-text regname_description">
                        Your name or organization's name.
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <input type="text" id="phone_no" name="phone_no" maxlength="100" placeholder="Phone" value="">
                </td>
                <td>
                    <span id='regname_error' class='wy-red wy-clear'></span>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="wy-clear wy-font-level-4 wy-multiyear-text phone_description">
                        We will follow up if the order doesn't go through.
                    </div>
                </td>
            </tr>
            <tr>
                <td style="vertical-align:bottom">
                    <div id="coupon-code-block" class="cm-cart-row wy-small-bottom-margin">
                        <input type="text" id="coupon_code" name="coupon_code" placeholder="Coupon code if any" value="" >
                        <input type="button" id="discount-check" value="Apply code" >
                    </div>
                </td>

                <td>
                    <div class="cm-cart-row  wy-middle"><!-- wy-small-bottom-margin wy-really-small-negative-top-margin">-->
                        <span id="invalid-coupon" class='form-error wy-clear wy-red'><span class="wy-img-text">&nbsp;</span><span class='wy-img-button'></span></span>
                    </div>
                </td>
                <td align="right">
                    <input type="button" id="checkoutButton" value="Checkout" class="wy-button wy-font-level-3 wy-green">
                </td>
            </tr>
        </table>
    </div>
    <div id="payment-header-bar" class="wy-clear wy-product-download-tab wy-inner-inner-tab wy-white">
        <div class="wy-product-download-label wy-font-level-3">
            <div class="wy-default-left-right-padding">
                <span class="cm-icons" id="circle3-icon">&nbsp;</span>
                <span class="wy-product-download-label-text">
                    Credit card details
                </span>
            </div>
        </div>
    </div>
    <div id="payment-section" style="display:none;" class="wy-product-download-tab wy-default-left-right-padding wy-bottom-margin">
        <div class="payment-errors wy-red wy-small-top-margin wy-default-left-right-padding"></div>
        <form action="" method="POST" id="payment-form">
            <table border="1" cellpadding="10" cellspacing="20" width="920px" class="wy-default-left-right-padding wy-font-level-3">
                <tr>
                    <td  width="20%" valign="top">Card number</td>
                    <td>
                        <input type="text" maxlength="16" size="20" autocomplete="off" class="card-number" value=""/>
                        <div id="card_type">
                            <span class="card_type creditcard visa "></span>
                            <span class="card_type creditcard mastercard"></span>
                            <span class="card_type creditcard discover "></span>
                            <span class="card_type creditcard american "></span>
                            <span class="card_type creditcard jcb"></span>
                            <span class="card_type creditcard diners"></span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td valign="top">Card expiry (MM/YYYY)</td>
                    <td>
                        <input type="text" maxlength="2" size="2" class="card-expiry-month text-2char" value=""/>
                        <span class="wy-black"> / </span>
                        <input type="text" maxlength="4" size="4" class="card-expiry-year text-4char" value=""/>
                        
                        <span class ="cvc-cvv-text">CVV/CVC 
                        <input type="text" maxlength="4" size="4" class="card-cvc-number text-4char" value="">
                        </span>
                    </td>
                </tr>
                <tr>
                    <td width="20%" valign="top">Order Total</td>
                    <td>
                        <span id="total-price" class="wy-left wy-bold"></span>
                        <div id="paymentBackButton" style="cursor:pointer">
                            <div class="cm-icons edit-icon wy-left" style="margin-left:30px;"></div>
                            <div id="edit-order-text" class="wy-left">&nbsp;Edit order</div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td align="left">
                        <input type="button" id="paymentButton" value="Pay" class="wy-small-button wy-white wy-font-level-3 wy-green">
                    </td>
                </tr>
            </table>
        </form>

    </div>
    <div id="payment-success-section" style="display:none;" class="wy-product-download-tab wy-default-left-right-padding wy-bottom-margin">
        <div class="wy-inner-page-background">
            <div class="wy-inner-full-container" style="width:auto !important">
                <div id="payment-successful-message-div" class="wy-font-level-3">
                    <div class="wy-left">
                        <span id="nice-tick-mark" class="wy-img-button"></span>
                    </div>
                    <div id="payment-successful-message"class="wy-left wy-really-small-top-margin">
                        <div class="wy-font-level-2 wy-bold">
                            Payment successful
                        </div>
                        <div class="wy-font-level-3 wy-green-text">
                            Thank you for the business. We will shortly email you the license. If you don't receive the email, please contact us at <a class="underlined" href="mailto:sales@webyog.com">sales@webyog.com</a>.
                        </div>
                    </div>
                </div>
                <div id="customer-details-popup" class="wy-font-level-3 wy-clear wy-top-margin">
                    You might want to update these details for records.
                    <table width="100%" >
                        <tr height="40px">
                            <td width="20%">
                                First Name
                            </td>
                            <td>
                                <input type="text" name="customer-fname" id="customer-fname" />
                            </td>
                        </tr>
                        <tr height="40px">
                            <td width="20%">
                               Last Name
                            </td>
                            <td>
                                <input type="text" name="customer-lname" id="customer-lname" />
                            </td>
                        </tr>
                        <tr height="40px">
                            <td>
                                Phone
                            </td>
                            <td>
                                <input type="text" name="customer-phone" id="customer-phone" />
                            </td>
                        </tr>
                        <tr height="40px">
                            <td>
                            </td>
                            <td>
                                <input id="save-updated-details" type="button" class="wy-center-text wy-white wy-font-level-3 wy-small-button wy-button" value="Save"/>
                                <span id="updated-details-message" class='form-error wy-clear wy-red' style="display:none;"><span class="wy-img-text">&nbsp;</span><span class='wy-img-button'></span></span>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div id="product-form-block">
            </div>

</div>

<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-256194-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    //    //  test tracking codes
    //    var _gaq = _gaq || [];
    //    _gaq.push(['_setAccount', 'UA-38616975-1']);
    //    _gaq.push(['_setDomainName', 'ts.webyog.com']);
    //    _gaq.push(['_trackPageview']);
    //
    //    (function() {
    //        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    //        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    //        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    //    })();



</script>
<!--[if IE]>
  <script type="text/javascript">
    $(document).ready(function(){
        $("#purchase_email").watermark("Email (required)",{className:"shoppingcart_placeholder", useNative:false});
        $("#reg_name").watermark("Registered to (required)",{className:"shoppingcart_placeholder", useNative:false});
        $("#phone_no").watermark("Phone",{className:"shoppingcart_placeholder", useNative:false});
        $("#coupon_code").watermark("Coupon code if any",{className:"shoppingcart_placeholder", useNative:false});
});
  </script>
<![endif]-->


<script>(function() {
        var _fbq = window._fbq || (window._fbq = []);
        if (!_fbq.loaded) {
            var fbds = document.createElement('script');
            fbds.async = true;
            fbds.src = '//connect.facebook.net/en_US/fbds.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(fbds, s);
            _fbq.loaded = true;
        }
        _fbq.push(['addPixelId', '128245154173653']);
    })();
    window._fbq = window._fbq || [];
    window._fbq.push(['track', 'PixelInitialized', {}]);
</script>
<noscript><img height="1" width="1" alt="" style="display:none" src="https://www.facebook.com/tr?id=128245154173653&amp;ev=PixelInitialized" /></noscript>


<script src="//platform.twitter.com/oct.js" type="text/javascript"></script>
<script type="text/javascript">twttr.conversion.trackPid('l6adm', { tw_sale_amount: 0, tw_order_quantity: 0 });</script>
<noscript>
    <img height="1" width="1" style="display:none;" alt="" src="https://analytics.twitter.com/i/adsct?txn_id=l6adm&p_id=Twitter&tw_sale_amount=0&tw_order_quantity=0" />
    <img height="1" width="1" style="display:none;" alt="" src="//t.co/i/adsct?txn_id=l6adm&p_id=Twitter&tw_sale_amount=0&tw_order_quantity=0" />
</noscript>

        
<script type="text/javascript">
    $(document).ready(function(){
        $("#payment-section").hide();
        setEmailPopupAnchors();
    });
    $(window).load(function() {
        if(window.location.hash == '#directLink') {
            if ($('.minicart-section').is(':visible')) {
                $('#view-cart').colorbox({open:true});
            }
        } else if(window.location.hash == '#pay') {
            if ($('.minicart-section').is(':visible')) { 
                $('#checkout-form').hide();
                window.setTimeout(function(){$('#view-cart').colorbox({open:true})},10);
            }
        }
    });   
    /*
     *  Global variables that I intend to use.
     */
    //Cart holds the shopping cart as a JS object.
    //I read its value from the cookie.
    //I need its value to be initialized when read the cart.
    //I need its value to be synchronized to what is there in the cart.
    var cart="";

    var issave = 1;

    /*
     *  These are global variables. They are used to store details. The details
     *  are of the product currently shown in step 1. These details are used in
     *  to decide what is to be shown to the user and in the call to saveFormData.
     */
    var productName = "";
    var productId = -1;
    var productPrice = -1;
    var productOriginalPrice = -1;
    var productQuantity = 0;
    var productMultiyear = 1;
    var purchaseType = "new";
    var cartEdit = 0;
    var regName = null;
    var purchaseEmail = null;
    var animateTotal = false;
    var optionShown = -1;
    var shoppingCartShown = false;
    var colorboxTimer = null;
    var checkoutBtnClick=0;
    //JScrollPane related global variables
    var api = null;

    //A global variable to specify w
    var percentScrolledY = 0;

    //A global variable to specify whether to allow review of the order or not.
    //By default set to true to indicate that we want to allow the review of the
    //order by default.
    //
    //
    //1. When going from step 2 to step 3, this should be set to true. This
    //  is the only normal way to go to step 3. Otherwise, someone would have to
    //  call the Javascript manually through the console.
    //2. As soon as Pay is clicked this should become false.
    //3. If there was an error, we would still be on step 3. At this point the
    //  user should be allowed to review the cart. This has to be done for all
    //  kinds of errors - customer errors, stripe errors. Every if-else, switch-case
    //  has to be covered. Allow review should be set to true in every such case.
    //4. Else, we would be showing the payment success page. At this point it
    //  doesn't matter whether the user is allowed to review the cart or not. If
    //  the user builds the cart again, then he would have to go from step 2 to
    //  step 3 and we are covered.
    var allowReview = true;


    var NO_FIVE_YEAR = 'nofiveyear';


    /**
     *  I want to write a function that refreshes the cart based global variables
     *
     *  Logic:
     *
     *  1. Refresh the global variables using the cart item at  @index.
     *
     *  Parameters:
     *
     *  @index: The index of the cart item to reflect in the global variables.
     *
     *  Preconditions:
     *
     *  None
     *
     *  Postconditions:
     *
     *  None
     *
     *  Returns:
     *
     *  Nothing
     *
     */
    function refreshGlobalVariables(index){
        cart = JSON.parse($.cookie('shopping_cart'));

        productName = cart[index].item_name;
        productId = cart[index].item_number;
        productPrice = cart[index].amount;
        productOriginalPrice = cart[index].productOriginalPrice;
        productQuantity = cart[index].quantity;
        productMultiyear = cart[index].productMultiyear;
        purchaseType = cart[index].purchaseType;

    }

    /*
     *  This function has the logic to hide or show the 5 year multiyear option.
     *  The 5 year multiyear option should be shown only for the the single and
     *  5 User versions of SQLyog, and for Visifire Upgrades in the normal case. 
     *  
     *  Occasionally, the condition may change for offer. 
     *
     *  Preconditions:
     *
     *  Postconditions:
     *
     *  1. The life-mutiyear option is either shown or hidden
     *
     *  Returns:
     *
     *  Nothing.
     *
     */
    function showMultiyearOption(productName) {
        var pattern1=/SQLyog (.*) - Single/;
        var pattern2=/SQLyog (.*) - 5 User/;
        var pattern3=/Visifire/;
        var pattern4=/MONyog (.*) - Unlimited/;
        
        
        if(!pattern4.test(productName)) {
 //        if((pattern3.test(productName))) {
             $('#life-multiyear').show();
         } else {
             $('#life-multiyear').hide();
         }
        
    }

    /*
     *  A function that fetches the applicable discount for this coupon code for
     *  the items in formdata. It makes an ajax call to the server, and that call
     *  returns the discount details as a JSON.
     *
     *  These details are stored in the 'discount' cookie .
     *
     *  Parameters:
     *
     *  @code:  the discount coupon code to validate against the database
     *  @formData: the shopping cart as a form, to validate
     *
     *  PreCondition: None
     *
     *  PostCondition: The discount cookie is set in case of successful
     *  completion, and nothing otherwise.
     *
     *  Returns: Nothing
     */
    function calculateDiscount(code, formData) {
        $("#invalid-coupon").hide();
        if(code=='') {
            $("#invalid-coupon").html("<span class='wy-img-text wy-red'>You haven't entered a coupon code</span><span class='wy-img-button'></span>");
            $("#invalid-coupon").show();
            return;
        }
        $.post("/shoppingcart/getDiscount",
        {
            couponCode:code,
            formdata: formData
        },
        function(data) {
            if(data){
                if(parseInt(data)==-1){
                    $.cookie('discount',null, {path: "/"});
                    showOption(2,false);
                    getMiniCart();
                    getShoppingCart();
                    $("#invalid-coupon").html("<span class='wy-img-text wy-red'>This coupon cannot be applied on this product</span><span class='wy-img-button'></span>");
                    $("#invalid-coupon").show();
                } else {
                    $("#coupon_code").val('');
                    $.cookie("discount",data,{path: "/", expires:7});

                    showOption(2,false);
                    getMiniCart();
                    getShoppingCart();

                    animateTotal=true;

                    var totalWithoutDiscount = parseFloat($("#total-without-discount").html().substring(1));
                    var finalTotal = parseFloat($("#final-total").html());
                    var finalTotalFloor = Math.floor(finalTotal);
                    animateAmount2($("#final-total"), totalWithoutDiscount, finalTotalFloor,function(){$("#final-total").html(finalTotal)} );

                    animateTotal=false;
                }

            }
            else {
                $.cookie('discount',null, {path: "/"});
                showOption(2,false);
                getMiniCart();
                getShoppingCart();
                $("#invalid-coupon").html("<span class='wy-img-text wy-red'>Invalid coupon code</span><span class='wy-img-button'></span>");
                $("#invalid-coupon").show();

            }
        });
    }
    
    /*
     *  A function that updates the name and phone number of the customer who just 
     *  made a purchase. It makes an ajax call to the server to do this.
     *
     *  Parameters:
     *
     *  None
     *
     *  PreConditions: 
     *  
     *  None
     *
     *  PostConditions: 
     *  
     *  a) A message is shown to the customer stating whether the details were or 
     *     weren't updated
     *  b) If the details are actually updated, the popup should close in 2 s.
     *
     *  Returns: Nothing
     */
    function updateCustomerDetails() {
        $("#updated-details-message").hide(0);
        if(($("#customer-fname").val()=='') && ($("#customer-lname").val()=='') && ($("#customer-phone").val()=='')) {
            $("#updated-details-message").html("<span class='wy-img-text wy-red'>&nbsp;&nbsp;Nothing to update</span><span class='wy-img-button'></span>");
            $("#updated-details-message").show();
            return;
        }
        $.post("/shoppingcart/updateCustomer",
        {
            customerId: customerId,
            fname: $("#customer-fname").val(),
            lname: $("#customer-lname").val(),
            phone: $("#customer-phone").val()
        },
        function(data) {
            data = JSON.parse(data);
            if(data.status === 'success'){
                $("#updated-details-message").show(0).html("<span class='wy-img-button feature-present'></span><span class='wy-img-text wy-green-text'>Thank you!</span>");
                colorboxTimer = window.setTimeout(function(){
                    $.colorbox.close();
                    //window.location='/shop';
                },2000);
            }
            else {
                $("#updated-details-message").html("<span class='wy-img-text wy-red'>&nbsp;&nbsp;It seems we weren't able to save your details. Sorry, please try again.</span><span class='wy-img-button'></span>");
                $("#updated-details-message").show();

            }
        });
    }

    /*
     *  Animates the the total value span from startAmount to endAmount
     *
     *  Parameters:
     *
     *  @startAmount: The amount to start the animation.
     *  @endAmount: The amount at which the animation stops.
     *
     *  Logic:
     *
     *
     *
     *  Preconditions:
     *
     *  None
     *
     *  Postconditions:
     *
     *  1. The total-value span has the value endAmount.
     *
     *  Returns:
     *
     *  Nothing
     *
     */
    function animateAmount2(counterx,startAmount, endAmount, callback) {

        if(animateTotal == false) {
            return false;
        }
        if(typeof(id)!='undefined'){
            clearInterval(id);
        }
        var
        i = startAmount,
        n = endAmount,
        dur = 1000, // 1 second
        intr = 100,
        s = Math.round(Math.abs(n-i) / (dur / intr));


        if(i<n){

            id = setInterval(function() {

                counterx.html((i += s));
                if (i >= n) {
                    clearInterval(id);
                    counterx.html(n);
                    if(callback!=null){
                        callback();
                    }
                }
            }, intr);

        }else if(i>n){
            id = setInterval(function() {

                counterx.html((i -= s));
                if (i < n) {
                    clearInterval(id);
                    counterx.html(n);
                    if(callback!=null){
                        callback();
                    }
                }
            }, intr);

        }

    }

    /*
     *  A function that gets the shopping cart into the popup from the cookie.
     *
     *  Logic:
     *
     *
     *
     *  Parameters:
     *
     *  None
     *
     *  Preconditions:
     *
     *
     *  Postconditions:
     *
     *  None
     *
     *
     */
    function getShoppingCart() {
        $("#checkout-customer-info").hide();


        if($.cookie('shopping_cart')!=null){
            cart=JSON.parse($.cookie("shopping_cart"));

            html ='<b><table cellspacing=\'0\' cellpadding=\'0\' width=\'920px\' class=\'wy-default-left-right-padding wy-font-level-3 checkout-product-list wy-really-small-top-margin\'>'
                +'<tr>'
                +'<td class=\'cm-cart-row\' width=\'62%\'>Product Name</td>'
                +'<td class=\'cm-cart-row\' width=\'10%\' align=\'right\'>Qty</td>'
                +'<td class=\'cm-cart-row\' width=\'10%\' align=\'right\'>Cost</td>'
                +'<td class=\'cm-cart-row\' width=\'9%\' align=\'right\'>&nbsp;</td>'
                +'<td class=\'cm-cart-row\' width=\'9%\' align=\'right\'>&nbsp;</td>'
                +'</tr>'
                +'</table></b><div id="checkout-product-div"><table cellspacing=\'0\' cellpadding=\'0\' width=\'920px\' class=\'wy-default-left-right-padding wy-font-level-3 checkout-product-list\'>';


            var discountInfo=JSON.parse($.cookie("discount"));
            var discount = 0;
            var total = 0;
            var payable = 0;


            for(i=0;i<cart.length;i++){
                var itemTotal = (cart[i].quantity * cart[i].amount);
                html+="<tr>"
                    +"<td width='62%' class=\'cm-cart-row\'>" + cart[i].item_name + "<br /><span class='wy-clear wy-font-level-5 wy-multiyear-text'>(" + getMultiyearText(cart[i].productMultiyear, cart[i].purchaseType) + ")</span></td>"
                    +"<td width='10%' class='cm-cart-row' valign='middle' align='right'>"
                    +"<table id='qty-table' style='border:0px solid red;' cellspacing='0' cellpadding='0'>"
                    +"<tr>"
                    +"<td rowspan=2 style='border: 0px !important'>"
                    +"<input type='text' class='p_quantity' readonly='readonly' id='p_quantity_" + i + "' value='" + cart[i].quantity + "'>"
                    +"</td>"
                    +"<td>"
                    +"<a href='javascript:increaseQty(\"p_quantity_" + i + "\")'><span class='card-icons increase-quantity-button"
                    +((cart[i].purchaseType=="upgrade") ? "-grey" : "")
                    +"'></span></a>"
                    +"</td>"
                    +"</tr>"
                    +"<tr>"
                    +"<td>"
                    +"<a href='javascript:decreaseQty(\"p_quantity_" + i + "\")'><span class='card-icons decrease-quantity-button"
                    +(((cart[i].quantity ==1)  || (cart[i].purchaseType=="upgrade")) ? "-grey" : "")
                    +"'></span></a>"
                    +"</td>"
                    +"</tr>"
                    +"</table>"
                    + "<td width='10%'align='right' class='cm-cart-row'>$" + itemTotal + "</td>"
                    + "<td width='9%' align='center' class='cm-cart-row'><a href='javascript:void(0)' onclick=editCartProduct('" + i + "') class='cm-icons edit-icon'>&nbsp;</a></td>"
                    + "<td width='9%' align='center' class='cm-cart-row'><a href='javascript:void(0)' onclick=deteleCartProduct('" + i + "') class='wy-img-button product-delete-button'>&nbsp;</a></td>"
                    + "</tr>";
                total += cart[i].quantity * cart[i].amount;
            }
            html+= "</table></div></table><table cellspacing=\'0\' cellpadding=\'0\' width=\'920px\' class=\'wy-default-left-right-padding wy-font-level-3\'>";

            if ( discountInfo!=undefined && discountInfo!=null && discountInfo.value!=undefined && discountInfo.type!=undefined) {
                if (discountInfo.type == 'rate') {
                    discount = (total * discountInfo.value) / 100;
                } else if (discountInfo.type == 'amount') {
                    discount = 1.0* discountInfo.value;
                }
            }

            payable = total-discount;

            html+="<tr>"
                +"<td width='62%' align='right'>&nbsp;</td>"
                +"<td width='10%' align='right'>&nbsp;</td>"
                +"<td width='10%' align='right'>"
                +(discount!=0 ? "<span id='total-without-discount' class='wy-strikethrough wy-grey-text wy-font-level-5'>$"+total+"</span>" : "&nbsp;")
                +"</td>"
                +"<td width='9%' >&nbsp;</td>"
                +"<td width='9%' >&nbsp;</td>"
                +"</tr>";

            html+="<tr>"
                +"<td width='62%' align='right'></td>"
                +"<td width='10%' align='right'>Cart Total</td>"
                +"<td width='10%' align='right'>"
                +"$<span id='final-total' class='wy-bold'>"
                + payable + "</span></td>"
                +"<td width='9%' >&nbsp;</td>"
                +"<td width='9%' >&nbsp;</td>"
                +"</tr>"
                +"</table>";

            $("#total-price").html("$"+payable);

            html+= "<form id='checkoutForm' action='/shoppingcart/payment' method='post'>"
                + ((discount!=0)
                ? ("<input type='hidden' id='discount_amount' name='discount_amount' value='" + discountInfo.value+"'>" + "<input type='hidden' id='coupon' name='coupon' value='" + discountInfo.code+"'>"
            //                        + "<input type='hidden' id='tax_cart' name='tax_cart' value='0.00'>"
        )
            : "")
                +"<input type='hidden' id='regname' name='regname' value=''>";

            for(i=0;i<cart.length;i++){
                html += "<input type='hidden' id='product_name_"  + i + "' name='product_name[]' value='" + cart[i].item_name + "'>";
                html+="<input type='hidden' id='product_quantity_" + i + "' name='product_quantity[]' value='" + cart[i].quantity + "'>";
                html+="<input type='hidden' id='product_price_" + i + "' name='product_price[]' value='" + cart[i].amount + "'>";
                html+="<input type='hidden' id='product_id_" + i + "' name='product_id[]' value='" + cart[i].item_number + "'>";
                html+="<input type='hidden' id='product_multiyear_" + i + "' name='product_multiyear[]' value='" + cart[i].productMultiyear + "'>";
                html+="<input type='hidden' id='purchase_type_" + i + "' name='purchase_type[]' value='" + cart[i].purchaseType + "'>";
            }

            html+="</form>";
            $("#finalShoppingCart").html(html);

            if((typeof(cart)!= 'undefined') && (cart!=null) && cart.length > 0) {
                /*
                 *  When recreating the cart, don't reinitialize regname.
                 */
                initializeRegNameAndPurchaseEmail();
                displayRegNameAndPurchaseEmail();

                var element = $('#checkout-product-div').jScrollPane();
                api = element.data('jsp');
                $("#checkout-customer-info").show();
            }

            $("#regname_error,#invalid-coupon").hide();
            $("#coupon_code").val("");

            if(discount!=0){
                $("#invalid-coupon").show(0).html("<span class='wy-img-button feature-present'></span><span class='wy-img-text wy-green-text'>Great! You saved&nbsp;"
                    +"$" + discount + "</span>");
                $("#coupon_code").val(discountInfo.code);
            }
            if(api!=null){
                api.scrollToPercentY(percentScrolledY);
                percentScrolledY=0;
            }
        } else {
            showOption(-1,false);
            return;
        }

    }

    /*
     *  A function that deletes the current item at index 'index' from the shopping
     *  cart.
     *
     *  Logic:
     *
     *
     *
     *  Parameters:
     *
     *  None
     *
     *  Preconditions:
     *
     *  None
     *
     *  Postconditions:
     *
     *  None
     *
     *
     */
    function deteleCartProduct(index) {
        //$products = $session->get('updateCart');
        $.cookie("discount",null, {path: "/"});
        cart=JSON.parse($.cookie("shopping_cart"));
        var tempProducts= new Array();
        for (i = 0,j=0; i < cart.length; i++) {
            if (i != index) {
                tempProducts[j++]= cart[i];
            }
        }
        if(tempProducts.length==0){
            $.cookie("shopping_cart",null,{path: '/', expires: 7});
        }
        else{
            $.cookie("shopping_cart",  JSON.stringify(tempProducts),{path: '/', expires: 7});
        }
        cart=JSON.parse($.cookie('shopping_cart'));
        $("#finalShoppingCart").html('');
        showOption(2,false);
        getMiniCart();
        getShoppingCart();



    }



    /*
     *  A function that does all the GUI work of showing
     *  options 1 and 2.
     *
     *  Logic:
     *
     *
     *
     *  Parameters:
     *
     *  @which
     *
     *  Preconditions:
     *
     *  None
     *
     *  Postconditons:
     *
     *  None
     *
     *  Returns:
     *
     *  Nothing
     */
    function showOption(which,slideDown){
        if(which==1){
            /*
             *  If the first option is to be displayed
             */
            //showMultiyearOption(NO_FIVE_YEAR);
            optionShown = 1;
            $("#emptyShoppingCart").stop(false,true).hide(0);
            $("#finalShoppingCart").stop(false,true).show(0);
            $('#shopping-form').stop(false,true).hide(0);
            $('#shopping-cart-header-bar').stop(false,true).show(0);
            $('#checkout-header-bar').stop(false,true).show(0);
            $('#checkout-customer-info').stop(false,true).hide(0);
            $('#checkout-form').stop(false,true).hide(0);
            $("#payment-section").stop(false,true).hide(0);
            $('#payment-header-bar').stop(false,true).show(0);
            $('#payment-success-section').hide();

            $('#shopping-cart-header-bar').css('background-color','#1D75D6');
            $('#shopping-cart-header-bar').removeClass('wy-grey-force');
            $('#shopping-cart-header-bar').find('span').addClass('wy-white');
            $('#checkout-header-bar').addClass('wy-grey-force');
            $('#checkout-header-bar').css('border-top','1px solid #e5e5e5');
            $('#checkout-header-bar').removeClass("wy-white").find('span').removeClass("wy-white");
            // CC details bar
            $('#payment-header-bar').addClass('wy-grey-force');
            $('#payment-header-bar').css('border-top','1px solid #e5e5e5');
            $('#payment-header-bar').css('border-bottom','1px solid #e5e5e5');
            $('#payment-header-bar').removeClass("wy-white").find('span').removeClass("wy-white");
            $('#edit-icon').removeClass('change-edit-icon');
            //$('#checkout-header-bar').addClass('wy-top-margin');

            $('#productnameblock').html(productName);
            showMultiyearOption($('#productnameblock').html());
            //showMultiyearOption(NO_FIVE_YEAR);
            $('#shopping-form').slideDown('slow');
            var lifeOptionShown = ($("#life-multiyear").is(":visible"));

            //            console.log($("#life-multiyear").is(":visible"));

            setColorboxDimensions(which, lifeOptionShown, 0, false);

        }else if (which==2){
            optionShown = 2;
            $("#emptyShoppingCart").stop(false,true).hide(0);
            $("#finalShoppingCart").stop(false,true).show(0);
            $('#shopping-form').stop(false,true).hide(0);
            $('#shopping-cart-header-bar').stop(false,true).show(0);
            $('#checkout-header-bar').stop(false,true).show(0);
            $('#checkout-customer-info').stop(false,true).hide(0);
            $('#checkout-form').stop(false,true).hide(0);
            $("#payment-section").stop(false,true).hide(0);
            $('#payment-header-bar').stop(false,true).show(0);
            $('#payment-success-section').hide();

            $("#checkout-customer-info").hide();
            $('#shopping-form').hide(0);
            $('#shopping-cart-header-bar').addClass('wy-grey-force');
            $('#shopping-cart-header-bar').find('span').removeClass('wy-white');
            $('#shopping-cart-header-bar').removeClass('wy-white');
            $('#checkout-header-bar').removeClass('wy-grey-force');
            $('#checkout-header-bar').addClass('wy-white');
            // CC details bar
            $('#payment-header-bar').addClass('wy-grey-force');
            $('#payment-header-bar').css('border-top','1px solid #e5e5e5');
            $('#payment-header-bar').css('border-bottom','1px solid #e5e5e5');
            $('#payment-header-bar').removeClass("wy-white").find('span').removeClass("wy-white");

            $('#edit-icon').addClass('change-edit-icon');
            $('#checkout-header-bar').removeClass('wy-top-margin')
            .addClass("wy-white").find('span').addClass("wy-white");
            //$("#checkout-customer-info").hide();
            cart= $.cookie('shopping_cart');

            cart= JSON.parse(cart);
            if(cart!=null){

                var discountApplicable = ($.cookie('discount')!=null);
                var numberOfProducts = cart.length;
                setColorboxDimensions(which, false, numberOfProducts , discountApplicable);
            }
            if(slideDown) {
                $('#checkout-form').slideDown('slow', function() {
                    setTimeout(function(){$("#purchase_email").focus();},500)
                });
            } else {
                $('#checkout-form').stop(false,true).show(0);
            }
        } else if (which==3){
            optionShown = 3;
            $("#emptyShoppingCart").stop(false,true).hide(0);
            $("#finalShoppingCart").stop(false,true).hide(0);
            $('#shopping-form').stop(false,true).hide(0);
            $('#shopping-cart-header-bar').stop(false,true).show(0);
            $('#checkout-header-bar').stop(false,true).show(0);
            $('#checkout-customer-info').stop(false,true).hide(0);
            $('#checkout-form').stop(false,true).hide(0);
            $("#payment-section").stop(false,true).hide(0);
            $('#payment-success-section').hide();

            $("#checkout-customer-info").hide();
            $('#shopping-form').hide(0);
            $('#shopping-cart-header-bar').addClass('wy-grey-force');
            $('#shopping-cart-header-bar').find('span').removeClass('wy-white');
            $('#shopping-cart-header-bar').removeClass('wy-white');
            $('#checkout-header-bar').addClass('wy-grey-force');
            $('#checkout-header-bar').removeClass("wy-white").find('span').removeClass("wy-white");
            // CC details bar
            $('#payment-header-bar').removeClass('wy-grey-force');
            $('#payment-header-bar').addClass('wy-white').find('span').addClass("wy-white");

            $('#edit-icon').addClass('change-edit-icon');
            $('#checkout-header-bar').removeClass('wy-top-margin');
            $('#checkout-header-bar').css('border-top','1px solid #e5e5e5');
            //$("#checkout-customer-info").hide();
            if(slideDown) {
                $("#payment-section").slideDown('slow',function(){
                    setTimeout(function(){$(".card-number").focus();},500)
                    
                });
                $('#payment-header-bar').slideDown('slow');
                
            } else {
                $('#payment-header-bar').stop(false,true).show(0);
            }

            cart= $.cookie('shopping_cart');

            cart= JSON.parse(cart);
            if(cart!=null){

                var discountApplicable = ($.cookie('discount')!=null);
                var numberOfProducts = cart.length;

                setColorboxDimensions(which, false, numberOfProducts , false);
            }

        } else if(which==-1){
            optionShown=-1;
            $("#emptyShoppingCart").show();
            $("#finalShoppingCart").hide();
            $('#shopping-form').hide();
            $('#shopping-cart-header-bar').hide();
            $('#checkout-header-bar').hide();
            $('#checkout-customer-info').hide();
            $('#payment-header-bar').hide();
            $("#payment-section").hide();
            $('#payment-success-section').hide();
            setColorboxDimensions(which, false, 0, false);
        } else if(which==-2){
            optionShown=-2;
            $('.card-number').val('');
            $('.card-cvc-number').val('');
            $('.card-expiry-month').val('');
            $('.card-expiry-year').val('');
            $('#shopping-cart-header-bar').hide();
            $('#shopping-form').hide();
            $('#checkout-header-bar').hide();
            $('#checkout-form').hide();
            $('#payment-header-bar').hide();
            $('#payment-section').hide();
            $('#payment-success-section').show();
            $("#updated-details-message").hide(0);
            $.cookie("shopping_cart",null,{path:"/",expires:7});
            $.cookie("discount",null,{path:"/",expires:7});
            $.cookie("regname",null,{path:"/",expires:7});
            $.cookie("purchase_email",null,{path:"/",expires:7});
            $.cookie("edit_cart_index",null,{path:"/",expires:7});
            getMiniCart();
            setColorboxDimensions(which, false, 0, false);
        }
    }

    /*
     *  A function that opens the element at index 'index' for editing.
     *
     *  Logic:
     *
     *
     *
     *  Parameters:
     *
     *  @which
     *
     *  Preconditions:
     *
     *  None
     *
     *  Postconditons:
     *
     *  None
     *
     *  Returns:
     *
     *  Nothing
     */
    function editCartProduct(index) {
        //$products = $session->get('updateCart');
        cart=JSON.parse($.cookie("shopping_cart"));

        productName = cart[index].item_name;
        productId = cart[index].item_number;
        productPrice = cart[index].amount;
        productOriginalPrice = cart[index].productOriginalPrice;
        productQuantity = cart[index].quantity;
        productMultiyear = cart[index].productMultiyear;
        purchaseType = cart[index].purchaseType;
        cartEdit=1;

        $.cookie("edit_cart_index",index , {path: "/", expires: 7});


        var year2PurchaseAmount = Math.floor(parseFloat(productOriginalPrice*0.5));
        //console.log(year2PurchaseAmount);
        $('#2yearPurchaseAmount').html(year2PurchaseAmount);
        //console.log($('#2yearPurchaseAmount').html());
        $('#lifePurchaseAmount').html(parseFloat(productOriginalPrice));
        //console.log($('#lifePurchaseAmount').html());

        $('input:radio[name=upgrade]')[productMultiyear-1].checked = true;
        productOriginalPrice = parseFloat(productOriginalPrice);


        $('.total-value').html(productOriginalPrice);

        animateTotal = false;
        fireSelect(productMultiyear);

        //productName global varibale is set here.
        showOption(1, false);


        $("#finalShoppingCart").html('');
        getMiniCart();
        getShoppingCart();
    }




    /*
     *  I want to parameterize saveFormData
     *
     *  Parameters:
     *
     *
     *
     */
    function saveFormData1(
    productName,
    productId,
    productPrice,
    productOriginalPrice,
    productQuantity,
    productMultiyear,
    purchaseType,
    cartEdit) {
        $.post("/shoppingcart/saveCart",
        {
            item_name: productName,
            item_number: productId,
            amount: productPrice,
            productOriginalPrice: productOriginalPrice,
            quantity: productQuantity,
            productMultiyear: productMultiyear,
            purchaseType: purchaseType,
            cartEdit: cartEdit

        },
        function(data) {
            //console.log($.cookie("shopping_cart"));
            cart=JSON.parse($.cookie("shopping_cart"));
            //                console.log(cart);
            if(data==0) {
                // alert('saving cart failed');
            } else if(data == '-101') {
                //alert(data);
                window.location.replace('/shoppingcart/payment_type_error');
            }
        });
    }


    /*
     *  I intend this version to do whatever the Server Side version used to do.
     *
     *  LOGIC:
     *
     *  i) Read the shopping cart Cookie.
     *  ii) If the cookie is not empty, set the cart variable to the object it
     *  represents.
     *  iii) Else, set the cart variable to the an empty array.
     *
     *  iv) If there are items in the cart variable.
     *          1.  If the purchase type of the new product is not the same are that of
     *              the items in the cart:
     *                  a. Remove the items in the cart variable.
     *                  b. Delete the discount cookie. The item is which it was applicable on
     *                  is now certainly gone.
     *                  c. Add the new item to the cart.
     *              Else:
     *                  a. For each item in the cart:
     *                      1. If the item number of the current item in the cart
     *                      matches the item number of the new cart item:
     *                          a. Set duplicate product to true.
     *                          b. If cartEdit is set to false:
     *                              1. Increase the quantity of the element by 1.
     *                          c. Set productOriginialPrice, productMultiyear and
     *                              amount to that of the new cart item.
     *                  b. If dulicateProduct is still false:
     *                      1.  Add the new cart item to the cart variable.
     *      Else:
     *          1. Delete the discount cookie. Whatever item it was applicable on is
     *          now certainly gone.
     *          2. Add the new cart item to the cart variable.
     *
     * v) Set the shopping cart cookie to reflect the contents of the cart variable.
     * vi) Return.
     *
     *
     *  Preconditions:
     *
     *
     *  Postconditions:
     *
     *  1) The global variable cart contains the shopping cart as a JS object.
     *  2) The 'shopping_cart' cookie contains the shopping cart as a JSON.
     *  3) The 'discount' cookie has been contains the correct discount to be
     *  applied to this cart.
     */
    function saveFormData(
    item_name,
    item_number,
    amount,
    productOriginalPrice,
    quantity,
    productMultiyear,
    purchaseType,
    cartEdit) {

        //Error checking
        if(

        (   typeof(item_name)=='undefined'
            ||typeof(item_number)=='undefined'
            ||typeof(amount)=='undefined'
            ||typeof(productOriginalPrice)=='undefined'
            ||typeof(quantity )== 'undefined'
            ||typeof(productMultiyear)=='undefined'
            ||typeof(purchaseType)=='undefined'
            ||typeof(cartEdit)=='undefined')

            ||

            ( item_name===null
            ||item_number===null
            ||amount===null
            ||productOriginalPrice===null
            ||productMultiyear===null
            ||quantity === null
            ||purchaseType===null
            ||cartEdit===null))
        {
            //This should not happen. Go to the error page.
            //            console.log (item_name+","+
            //                item_number+ ","+
            //                amount+ ","+
            //                productOriginalPrice+ ","+
            //                quantity + ","+
            //                purchaseType+ ","+
            //                productMultiyear + "," +
            //                cartEdit);

        }

        var cartCookie = $.cookie('shopping_cart');
        if(typeof(cartCookie)=='undefined' || cartCookie==null){
            cartCookie=null;
        }
        if (cartCookie==null) {
            cart = new Array();
            _gaq.push(['_trackPageview','/Item-Added']);
        } else {
            cart= JSON.parse(cartCookie);
        }


        var newCartItem = new Object();

        newCartItem.item_name= item_name;
        newCartItem.item_number= item_number;
        newCartItem.amount= amount;
        newCartItem.productOriginalPrice= productOriginalPrice;
        newCartItem.quantity= quantity;
        newCartItem.productMultiyear= productMultiyear;
        newCartItem.purchaseType= purchaseType;

        var duplicateProduct = new Boolean();
        duplicateProduct = false;


        if (cart.length > 0) {
            $.cookie('discount',null, {path: "/"});
            for (i = 0; i < cart.length; i++) {
                if ((cart[i].item_number == item_number) && (cart[i].purchaseType == purchaseType)) {
                    $.cookie("edit_cart_index",i , {path: "/"});
                    duplicateProduct = true;
                    if (cartEdit == false && (purchaseType=='new')) {
                        cart[i].quantity = parseInt(cart[i].quantity) + 1;
                    }
                    cart[i].productMultiyear = productMultiyear;
                    cart[i].amount = amount;
                    cart[i].productOriginalPrice = productOriginalPrice;
                }
            }
            if (!duplicateProduct) {
                $.cookie('discount',null, {path: "/"});
                $.cookie("edit_cart_index", cart.length , {path: "/"});
                cart=cart.concat(new Array(newCartItem));
            }
        } else {
            $.cookie('discount',null, {path: "/"});
            $.cookie("edit_cart_index",0, {path: "/"});
            cart = new Array(newCartItem);
        }

        $.cookie('shopping_cart', JSON.stringify(cart), {path: "/", expires: 7});
    }

    /*
     *  This function updates quantity of the cart item at index 'index' with
     *  value 'value'.
     *
     *  Logic:
     *
     *  1. Read the cart contents from the shopping cart cookie.
     *  2. If the cart type is not upgrade:
     *      a.  Set the percentScrolledY global variable with the percent the
     *          checkout product div has been scrolled.
     *      b.  For i = 0 to (cart.length - 1):
     *          i.  if (i == @index)
     *              1.  Set quantity of the item at index @index in the cart variable
     *                  to @value.
     *      c.  Set the shopping_cart cookie to the contents of the cart variable.
     *      d.  Read back the contents of the cart cookie into the cart variable.
     *      e.  Delete the discount cookie.
     *      f.  Clear the contents of the finalShoppingCart div.
     *      g.  Call getMiniCart to repopulate the minicart from the cookie.
     *      h.  Call getShoppingCart to repopulate the shopping cart from the cookie.
     *
     *
     *  Parameters:
     *
     *  @index: The index of the cart item to update.
     *  @value: The quantity of the the cart item at that index.
     *
     *  Preconditions:
     *
     *  1. The cart variable should contain exactly the contents of the shopping
     *  cart cookie.
     *
     *  Postconditions:
     *
     *  1. The shopping cart cookie contains the final shopping cart.
     *  2. The cart variable also contains the final shopping cart.
     *
     */
    function UpdateCartData(index, value) {

        cart = JSON.parse($.cookie("shopping_cart"));
        var i=0;
        var j=0;

        if(cart[index].purchaseType!='upgrade'){
            percentScrolledY = api.getPercentScrolledY();

            for (i = 0,j=0; i < cart.length; i++) {
                if (i == index) {
                    cart[i].quantity=value;
                }
            }

            $.cookie('shopping_cart',  JSON.stringify(cart),{path: '/', expires: 7});

            cart=JSON.parse($.cookie("shopping_cart"));
            $("#finalShoppingCart").html('');

            $.cookie('discount',null,{path: "/"});

            getMiniCart();
            getShoppingCart();
        }
    }

    /*
     *  This function is called to increment the quantity of a cart item.
     *
     *  Logic:
     *
     *  1.  Split @id into a string array based on _ and store in a local
     *      variable called @substr.
     *  2.  Create a local variable @index which contains the substring at index
     *      2 in @substr.
     *  3.  Create a local variable @qty and assign it the int value of the HTML
     *      element with id @id, plus 1.
     *  4.  Call updateCartData(@index,@value)
     *
     *  Parameters:
     *
     *  @id:    A string - the id of an html element. This element should contain the
     *          quantity of a cart item. @id will be of the form:
     *
     *                  p_quantity_<index>
     *
     *          where index is the quantity of the cart item this it holds.
     *
     *  Preconditions:
     *
     *  1.  The element with the id specified should contain the quantity of the
     *      item in the cart.
     *
     *
     *  Postconditions:
     *
     *  1.  The cart should have the corresponding item's quantity increased.
     *
     *  Returns:
     *
     *  Nothing
     *
     */
    function increaseQty(id) {
        var substr = id.split('_');
        var index = substr[2];
        var qty = (parseInt($('#'+id).val()) + 1);
        UpdateCartData(index, qty);
    }

    /*
     *  This function is called to decrement the quantity of a cart item.
     *
     *  Logic:
     *
     *  1.  Split @id into a string array based on _ and store in a local
     *      variable called @substr.
     *  2.  Create a local variable @index which contains the substring at index
     *      2 in @substr.
     *  3.  If the int value of the HTML element with id @id is not equal to 1:
     *      a.  Create a local variable @qty and assign it the int value of the
     *          HTML element with id @id, minus 1.
     *      b.  Call updateCartData(@index,@value)
     *
     *  Parameters:
     *
     *  @id:    A string - the id of an html element. This element should contain the
     *          quantity of a cart item. @id will be of the form:
     *
     *                  p_quantity_<index>
     *
     *          where index is the quantity of the cart item this it holds.
     *
     *  Preconditions:
     *
     *  1.  The element with the id specified should contain the quantity of the
     *      item in the cart.
     *
     *
     *  Postconditions:
     *
     *  1.  The cart should have the corresponding item's quantity decreased.
     *
     *  Returns:
     *
     *  Nothing
     *
     */
    function decreaseQty(id) {
        var substr = id.split('_');
        var index = substr[2];
        if($('#'+id).val() != 1) {
            var qty = (parseInt($('#'+id).val()) - 1);
            UpdateCartData(index,qty);
        }
    }

    //obsolete way of connectiong to olark
    //(function(){document.write(unescape('%3Cscript async=true src=\'' + (document.location.protocol == 'https:' ? "https:" : "http:") + '//static.olark.com/js/wc.js\' type=\'text/javascript\'%3E%3C/script%3E'));})();




    /*
     *  I want to write a function that fires the click event for the appropriate
     *  upgrade radio button input.
     *
     *  Logic:
     *
     *  1. The index of the cart item being edited is read from the edit_cart_index
     *  cookie.
     *  2. The global variables reflecting the cart item being edited are refreshed
     *  using the cart item at this index.
     *  3. The appropriate multiyear option is fired.
     *
     *  Preconditions:
     *
     *  1. The span holding the total value should have the corect value.
     *  2. The spans 2yearPurchase and lifePurchaseAmount should be set.
     *
     *  Postconditions:
     *
     *  1. Total value should be set in the span with the class total-value.
     *
     */
    function fireSelect(multiyear){
        cartEdit=1;
        oldValue = parseFloat($(".total-value").html());

        if($.cookie("edit_cart_index")==null){
            $.cookie("shopping_cart", null , {path:"/",expires: 7});
            $.cookie("discount", null, {path:"/"});
            $.cookie("edit_cart_index",null, {path:"/"});
            window.location.replace("/shop");
        }

        var refreshIndex = parseInt($.cookie("edit_cart_index"));
        refreshGlobalVariables(refreshIndex);

        if(productOriginalPrice==undefined || productOriginalPrice==null){
            $.cookie("shopping_cart", null , {path:"/",expires: 7});
            $.cookie("discount", null, {path:"/"});
            $.cookie("edit_cart_index",null, {path:"/"});
            window.location.replace("/shop");
        }
        if(multiyear == 1) {
            productOriginalPrice = parseFloat(productOriginalPrice);
            animateAmount2($(".total-value"),oldValue,productOriginalPrice,null);

            if(animateTotal==false)
                $('.total-value').html(productOriginalPrice);


            saveFormData(
            productName,
            productId,
            productOriginalPrice,
            productOriginalPrice,
            productQuantity,
            multiyear,
            purchaseType,
            cartEdit);
        } else if(multiyear == 2) {
            var amount = $('#2yearPurchaseAmount').html();
            amount = amount.replace("$","");
            var total = parseFloat(productOriginalPrice)+parseFloat(amount);

            animateAmount2($(".total-value"),oldValue,total,null);
            if(animateTotal==false)
                $('.total-value').html(total);


            saveFormData(
            productName,
            productId,
            total,
            productOriginalPrice,
            productQuantity,
            multiyear,
            purchaseType,
            cartEdit);
        } else if(multiyear == 3) {
            var amount = $('#lifePurchaseAmount').html();
            amount = amount.replace("$","");
            var total = parseFloat(productOriginalPrice*2);



            animateAmount2($(".total-value"),oldValue,total,null);
            if(animateTotal==false)
                $('.total-value').html(total);

            saveFormData(
            productName,
            productId,
            total,
            productOriginalPrice,
            productQuantity,
            multiyear,
            purchaseType,
            cartEdit);
        }
        getMiniCart();
    }



    /*
     * I want to write a function that returns the multiyear text for a given
     * product given its multiyear value and purchase type.
     *
     * Logic:
     *
     *
     *
     * Parameters:
     *
     * @productMultiyear: The multiyear value for the product.
     * @purchaseType: The purchase type - new or upgrade.
     *
     *
     * Preconditions:
     *
     * None
     *
     * Postconditions:
     *
     * None
     *
     */
    function getMultiyearText(productMultiyear, purchaseType){

        switch (productMultiyear) {
            case '2':
                multiyearText = "plus upgrades for 2 years";
                if (purchaseType == 'upgrade') {
                    multiyearText = "upgrades for 2 years";
                }
                break;
            case '3':
                multiyearText = "plus upgrades for 5 years";
                if (purchaseType == 'upgrade') {
                    multiyearText = "upgrades for 5 years";
                }
                break;
            default:
                multiyearText = "plus upgrades for 1 year";
                if (purchaseType == 'upgrade') {
                    multiyearText = "upgrades for 1 year";
                }
                break;
            }
            return multiyearText;
        }


        $(document).ready(function() {
            
            $("#save-updated-details").click(function(){
                updateCustomerDetails();
            });
            
            if(($.cookie("shopping_cart")!=null)
                && ($.cookie("shopping_cart").charAt(0)!='[')){
                $.cookie("shopping_cart",null,{path:"/",expires:7});
                $.cookie("discount",null,{path:"/",expires:7});
                $.cookie("edit_cart_index",null,{path:"/",expires:7});
            }


            initializeRegNameAndPurchaseEmail();
            if ($(".slideshow").length > 0){
                $('.slideshow').cycle({
                    fx: 'fade', // choose your transition type, ex: fade, scrollUp, shuffle, etc...
                    pager: '#nav'
                });
                $('.slideshow').show();
            }


            //            if (/*@cc_on!@*/false) { // check for Internet Explorer
            //                document.onfocusin = onFocus;
            //            } else {
            window.onfocus = onFocus;
            //            }


            $('input:radio[name=upgrade]').parents('li').click(function(){
                var multiyear = $(this).find('input:radio[name=upgrade]').val();
                $('input:radio[name=upgrade]')[multiyear-1].checked = true;
                animateTotal = true;
                fireSelect(multiyear);
            });



            cart=JSON.parse($.cookie("shopping_cart"));

            getMiniCart();

            $(".wy-price-submit-link, #view-cart, .wy-upgrade-price-link").colorbox(
            {
                inline:true,
                fixed: false,
                transition: 'none',
                scrolling: false,
                returnFocus: false,
                href: "#shopping-cart-container",
                onLoad: function(){
                    //                 console.log("Console log:"+this.id);
                    $("#updated-details-message").hide(0);
                    shoppingCartShown = true;
                    if(this.id=="view-cart"){
                        issave = 0;
                        getMiniCart();
                        getShoppingCart();
                        window.setTimeout(function(){
                            $('#proceed_checkout_button').trigger('click');
                        },000);
                    }
                    else{
                        issave = 1;
                        cartEdit=0;

                        if($(this).hasClass('wy-price-submit-link')){
                            submitForm = $("#"+submitId).find("form").get(0);
                        } else {
                            submitForm = $(this).find("form");
                        }

                        productName = $(submitForm).find("input[name=item_org_name]").val();
                        productId = $(submitForm).find("input[name=item_number]").val();
                        productPrice = parseFloat($(submitForm).find("input[name=amount]").val());
                        productOriginalPrice = productPrice;
                        productQuantity = $(submitForm).find("input[name=quantity]").val();
                        productMultiyear = 1;
                        purchaseType = $(submitForm).find("input[name=purchase_type]").val();


                        //                        showMultiyearOption(NO_FIVE_YEAR);
                        showMultiyearOption(productName);

                        $('#2yearPurchaseAmount').html((Math.floor(parseFloat((productPrice*1.5)-productPrice))));
                        $('#lifePurchaseAmount').html((Math.floor(parseFloat((productPrice*2)-productPrice))));

                        $("span.item-added-name").html($(submitForm).find("input[name=item_name]").val());
                        $("span.total-value").html(productPrice);



                        $('input:radio[name=upgrade]')[0].checked = true;
                        saveFormData(
                        productName,
                        productId,
                        productOriginalPrice,
                        productOriginalPrice,
                        productQuantity,
                        productMultiyear,
                        purchaseType,
                        cartEdit);
                        getMiniCart();

                        $('#checkout-form').hide();
                        $('#checkout-header-bar').removeClass('wy-white');
                    }


                    $("#emptyCartButton").click(function(){
                        var rloc = $('#emptycartmsg a').attr("href");
                        window.location.href = rloc;
                    });

                    $('#continue_button').click(function(){

                        var pattern = / *(\/shop|\/product\/sqlyog|\/product\/monyog)/ ;

                        if(pattern.test(window.location.href)){
                            $.colorbox.close();
                        }else {
                            window.location.href='/shop';
                        }

                    });

                    $('#proceed_checkout_button').click(function(){
                        showOption(2,true);
                        getMiniCart();
                        getShoppingCart();
                        $.removeCookie('edit_cart_index');

                    })

                    $("#checkoutButton").click(function() {
                        //By default we want to allow a return to step 2.
                        allowReview = true;
                        $("#regname_error").hide();
                        $("#regname_error").html('');
                        $("#email_error").html('');
                        
                        customerEmail = $("#purchase_email").val();
                        
                        if(customerEmail !='') {
                            if(validateEmail(customerEmail)) {
                                $("#email_error").text('');
                                //return true;
                            } else {
                                $("#email_error").text('Please enter a valid email');
                                $("#purchase_email").focus();
                                return false;
                            }
                        } else {
                            $("#email_error").text("Please enter an email");
                            $("#purchase_email").focus();
                            return false;
                        }
                        if($.trim($("#regname").val())!='') {
                            $(".payment-errors").html('');
                            showOption(3,true);

                            if(checkoutBtnClick==0){
                                _gaq.push(['_trackPageview','/Payment-Checkout']);
                                checkoutBtnClick=checkoutBtnClick+1;
                                trackCheckoutButtonClick();
                            }
                            //console.log("times");
                           
                        } else {
                            $("#regname_error").show();
                            $("#regname_error").html('Please enter the registration name');
                        }

                    })

                    // copying the regname inside form
                    $("#reg_name").blur(function(){
                        $("#regname").val($("#reg_name").val());
                        initializeRegNameWithVal($("#reg_name").val());
                        displayRegNameAndPurchaseEmail();
                    });

                    $("#purchase_email").blur(function(){
                        //                        alert($("#purchase_email").val());
                        initializePurchaseEmailWithVal($("#purchase_email").val());
                        displayRegNameAndPurchaseEmail();
                    });
                    

                    // Discount coupon check
                    $("#discount-check").click(function(){
                        var formData = $("#checkoutForm").serializeArray();
                        var code = $("#coupon_code").val();
                        if(code!='') {
                            code = code.replace(/^\s+|\s+$/g, "");
                            calculateDiscount(code, formData);
                        } else {
                            calculateDiscount('', formData);
                        }

                    });

                    $('#shopping-form').slideDown('slow');


                    $("#shopping-cart-container").show();

                },
                onClosed:function(){
                    $("#shopping-cart-container").hide();
                    $("#updated-details-message").hide(0);
                    $.removeCookie("edit_cart_index");
                    $('.card-number').val('');
                    $('.card-cvc-number').val('');
                    $('#card_type .creditcard').removeClass('inactive');
                    $('.card-expiry-month').val('');
                    $('.card-expiry-year').val('');
                    $('#card_type .creditcard').removeClass('inactive');
                    if((typeof(colorboxTimer)!='undefined') && (colorboxTimer!=null)){
                        window.clearTimeout(colorboxTimer);
                    }
                    $("#payment-section").hide();
                    shoppingCartShown =false;
                    clearInterval(colorboxTimer);
                },
                onComplete: function(){
                    $("#shopping-cart-container").show();
                    if(issave==1){
                        //productName global varibale will have been set in the
                        //onLoad callback
                        showOption(1,false);
                    }
                    $("#emptyShoppingCart").stop(false,true).hide(0);
                    
                }

            }).css("cursor","pointer");


            $(".wy-price-submit-link").click(function(){
                submitId=$(this).parents("li:first").attr("id");
            });


            if( $(location).attr("href").indexOf("/search")== -1 ){
                $("#search").watermark("Search",{className:"wy-watermark-1", useNative:false});
            }



            $(document).click(function(event){
                //console.log(event.target.id);
                switch(event.target.id) {
                    case 'minicart':
                    case 'wy-cart-icon':
                    case 'minicart_count':
                    case 'my-minicart':
                        $("#tooltip-arrow").show();
                        $("#tooltip-content").show();
                        break;
                    default:
                        $("#tooltip-arrow").hide();
                        $("#tooltip-content").hide();
                        break;
                }
            })

            // Stop hiding minicart if clicked inside that
            $("#tooltip-content").click(function(event){
                // Stop hiding minicart if clicked inside that
                if(event.target.id!="view-cart-span")
                    event.stopPropagation();
            });

            $("#paymentBackButton").click(function(){
                if(allowReview){
                    showOption(2, true);
                    getShoppingCart();
                } else {
                    return false;
                }

            });

            (function() {
                $.reject({
                    reject: {
                        all: false, // Covers Everything (Nothing blocked)
                        msie5: true, msie6: true, msie7: true // Covers MSIE 5-6 (Blocked by default)
                    },
                    closeMessage: 'Close this window at your own demise!', // Message below close window link
                    imagePath: 'https://static.webyog.com/images/jReject/images/'
                }); // Customized Text

                return false;
            })();

            getCustomerDetailsIntoCookie();
        });


        /*
         *   I want to write a function which displays the minicart.
         *
         *   Logic:
         *
         *
         *   Preconditions:
         *
         *   None
         *
         *   Postcondition:
         *
         *   1. The minicart section is poulated with the minicart
         *
         *
         */
        function getMiniCart() {
            cart = JSON.parse($.cookie("shopping_cart"));
            if(cart != null &&  cart.length > 0) {
                $(".wy-minicart-section").show();
                $("#minicart_count").html(cart.length);


                html="";
                var totalAmount = 0.00;
                var discountInfo=JSON.parse($.cookie("discount"));
                var discount = 0;
                var total = 0;
                var payable = 0;


                for (i = 0; i < cart.length; i++) {

                    totalAmount += ( cart[i].quantity * cart[i].amount);

                    productNameArr = cart[i].item_name.split("-");

                    if(productNameArr.length>=1)
                        productName1 = productNameArr[0]
                    else
                        productName1 =  '';

                    if(productNameArr.length>=2)
                        productName2 = productNameArr[1]
                    else
                        productName2 =  '';

                    //                productName2 = isset($productNameArr[1]) ? $productNameArr[1] : '';

                    var total = (cart[i].quantity * cart[i].amount);
                    html+="<tr>"
                        +"<td valign='middle' style='line-height:18px;' width='65%'><b>" + productName1 + "</b><p>" + productName2 + "</p></span></td>"
                        +"<td width='20%' valign='middle' align='center'><input disabled='disabled' type='text' value='"
                        +((cart[i].quantity>=10) ? cart[i].quantity : ("&nbsp;" + cart[i].quantity))
                        +"'></td>"
                        +"<td width='15%' valign='middle' align='right'>$" + total+ "</td>"
                        +"</tr>";

                }

                if ( discountInfo!=undefined && discountInfo!=null && discountInfo.value!=undefined && discountInfo.type!=undefined) {
                    if (discountInfo.type == 'rate') {
                        discount = (total * discountInfo.value) / 100;
                    } else if (discountInfo.type == 'amount') {
                        discount = 1.0* discountInfo.value;
                    }
                }
                payable = totalAmount-discount;

                html += "<tr>"
                    +"<td></td>"
                    +"<td class='wy-reset-padding-mini' align='right'><span class='wy-bold'></span></td>"
                    +"<td align='right' id='total-without-discount-minicart' class='wy-bold wy-font-level-5 wy-strikethrough wy-grey-text'>"
                    + ((discount!=0)? ("$" + totalAmount) :"")
                    + "</span></td>"
                    +"</tr>";
                html += "<tr>"
                    +"<td colspan=2 align='left'><b>Cart Total</b></td>"
                    +"<td align='right' class='wy-bold wy-font-level-5'>$" + payable + "</td>"
                    +"</tr>";
                $("#minicart-product-list").html(html);
            } else {
                $(".wy-minicart-section").hide();
                //$("#tooltip-arrow").hide();
                //$("#tooltip-content").hide();
            }

        }


        /*
         *   I want to write a function that sets the registration name for
         *   customer logged in to the site in the shopping cart popup.
         *
         *   Parameters:
         *
         *   None
         *
         *   Logic:
         *
         *   1. If the regName variable is set:
         *       a. Set the value of the cookie regname to this value.
         *       b. Set the value of the reg_name input to this value.
         *   2. Else:
         *       a. Do nothing.
         *   3. and 4. Same logic for email.
         *
         *
         *   Preconditions:
         *
         *   None
         *
         *   Postconditions:
         *
         *   1. An exception is thrown in unforeseen cases (or can you call them
         *   foreseen, now that I am commenting this?).
         *   Otherwise, the regName global variable is set with the value of
         *   the customer's registration name.
         *
         *   Returns:
         *
         *   Nothing.
         */
        function displayRegNameAndPurchaseEmail(){
            if(regName!=null){
                $("#reg_name").val(regName);
                $("#regname").val(regName);
                $.cookie("regname", regName, {path:"/", expires:7});
            }
            if(purchaseEmail!=null){
                //                alert("got here");
                $("#purchase_email").val(purchaseEmail);
                $.cookie("purchase_email", purchaseEmail, {path:"/", expires:7});
            }
        }

        /*
         *  I want to write a function that initializes the regName global variable
         *
         *   Parameters:
         *
         *   None
         *
         *   Logic:
         *
         *   1. If the regName variable is not set:
         *       a. Check the regname cookie.
         *       b. If it is set and not blank, set the regname variable to the value of this
         *       cookie.
         *       c. Else:
         *          If the cart_customer_details cookie is exists:
         *              I. Read the cart_customer_details cookie.
         *              II. Parse it into a Javascript object.
         *              III.  Read the 'regname' attribute if it exists
         *   2. Same logic for email.
         *
         *   Preconditions:
         *
         *   None
         *
         *   Postconditions:
         *
         *   1. The regName global variable is set with the value of
         *   the customer's registration name.
         *
         *   Returns:
         *
         *   Nothing.
         *
         */
        function initializeRegNameAndPurchaseEmail(){
            if(($.cookie("regname")!=null) && ($.cookie("regname")!="")){
                regName= $.cookie("regname");
                $("#reg_name").val(regName);
            } else {
                if($.cookie('cart_customer_details')!=null){
                    var result = JSON.parse($.cookie('cart_customer_details'));
                    regName= result.regname;
                    $("#reg_name").val(regName);
                }
            }
            if(($.cookie("purchase_email")!=null) && ($.cookie("purchase_email")!="")){
                purchaseEmail= $.cookie("purchase_email");
                $("#purchase_eemail").val(purchaseEmail);
            } else {
                if($.cookie('cart_customer_details')!=null){
                    var result = JSON.parse($.cookie('cart_customer_details'));
                    purchaseEmail= result.email;
                    $("#purchase_email").val(purchaseEmail);
                }
            }
            
            initialize_phone_number();

        }
        
        function initialize_phone_number()
        {   
            if(($.cookie("phone")!=null) && ($.cookie("phone")!="")){
                $("#phone_no").val($.cookie("phone"));
            } else {
                if($.cookie('cart_customer_details')!=null){
                    var result = JSON.parse($.cookie('cart_customer_details'));
                     
                    $("#phone_no").val(result.phone);
                }
            }
        }
        
        /*
         *  I want to write a function that initializes the regName global variable
         *  to a particular value.
         *
         *   Parameters:
         *
         *   @val: The value to set the regname variable to.
         *
         *   Logic:
         *
         *   1. Set the regName variable to @val.
         *   2. Return
         *
         *   Preconditions:
         *
         *   None
         *
         *   Postconditions:
         *
         *   1. The regName global variable is set with the desired value.
         *
         *   Returns:
         *
         *   Nothing.
         *
         */
        function initializeRegNameWithVal(val){
            regName=val;
        }

        /*
         *  I want to write a function that initializes the regName global variable
         *  to a particular value.
         *
         *   Parameters:
         *
         *   @val: The value to set the regname variable to.
         *
         *   Logic:
         *
         *   1. Set the purchaseEmail variable to @val.
         *   2. Return
         *
         *   Preconditions:
         *
         *   None
         *
         *   Postconditions:
         *
         *   1. The regName global variable is set with the desired value.
         *
         *   Returns:
         *
         *   Nothing.
         *
         */
        function initializePurchaseEmailWithVal(val){
            purchaseEmail=val;
        }


        /*
         *  I want to write a function that fetches the customer details
         *  and if available stores the result in a cookie.
         *
         *  Logic:
         *
         *  1. Make an AJAX call to get the customer details.
         *  2. If the details are available:
         *      a. Store them in a cookie.
         *      b. Set the purchase email.
         *  3. Else:
         *      a. Explicitly delete the customer details cookie.
         *
         *  Parameters:
         *
         *  None
         *
         *  Returns:
         *
         *  Nothing
         *
         *  Preconditions:
         *
         *  None
         *
         *  Postconditions:
         *
         *  The customer details get stored into the cookie.
         *
         */
        function getCustomerDetailsIntoCookie(){
            $.get('/shoppingcart/getCustomerDetails',
            null,
            function(result){
                if(result.status){
                    $.cookie("cart_customer_details", JSON.stringify(result),{path:"/",expires:7});
                } else {
                    $.cookie("cart_customer_details",null,{path:"/",expires:7});
                }
            }, 'json');
        }


        /*
         *  I want to write a function which returns the customer ID of
         *  the currently logged in customer.
         *
         *  Will write if required.
         *
         */


        /*
         *   I want to write a function that sets the discount code text in the
         *   shopping cart
         *
         *   Parameters:
         *
         *   None
         *
         *   Logic:
         *
         *   1. If the discount cookie is null:
         *       Set the text to blank
         *   2. Else
         *       a. Parse the contents of the discount cookie into a Javascript
         *       object.
         *       b. Display the code attribute of this object in the text box.
         *
         *   Preconditions:
         *
         *   None
         *
         *   Postconditions:
         *
         *   1.
         *
         *   Returns:
         *
         *   Nothing.
         */

        function onFocus(){
            if(shoppingCartShown){
                //console.log(optionShown);
                if((optionShown!=3) && (optionShown!=-2)) {
                    showOption(2,false);
                }
                if(optionShown!=-2) {
                    getShoppingCart();
                }
            }
            getMiniCart();

        };

        /**
         * A function to set the colorbox height based on 3 parameters:
         *
         * @which: which option to show
         * @lifeOptionShown:    a boolean to indicate whether the discount for five
         *                      years is
         * @numberOfProducts: the number of products in the cart
         * @discount: a boolean to indicate whether there is a valid discount applicable
         */
        function setColorboxDimensions(which, lifeOptionShown,
        numberOfProducts, isError){
            // If the first option is to be displayed.
            if(which==1){
                //If the five year option is shown
                if(lifeOptionShown){
                    $.colorbox.resize({ innerHeight: "480px" });
                    $("#shopping-cart-container").attr("height","480px");
                } else { //Otherwise
                    $.colorbox.resize({ innerHeight: "432px" });
                    $("#shopping-cart-container").attr("height","480px");
                }
            } else if(which==2){ //If the second option is to be displayed
                //If the number of products in the cart is 1

                if(numberOfProducts==1){
                    $.colorbox.resize({ innerHeight: "595px" });
                    $("#checkout-form").css({'height':'440px'});
                    $("#shopping-cart-container").attr("height","595px");
                } else { //If the number of products in the cart is more that 1
                    $.colorbox.resize({ innerHeight: "660px" });
                    $("#checkout-form").css({'height':'505px'});
                    $("#shopping-cart-container").attr("height","660px");
                }
            } else if(which == 3) {
                if(isError) {
                    $.colorbox.resize({ innerHeight: "450px" });
                    $("#shopping-cart-container").css({'height':'450px'});
                } else {
                    $.colorbox.resize({ innerHeight: "430px" });
                    $("#shopping-cart-container").attr("height","430px");
                }

            } else if(which == -1){ /*If the empty cart is to be displayed*/
                $.colorbox.resize({
                    innerHeight: "490px"
                });
                $("#shopping-cart-container").attr("height","490px");
            } else if(which == -2){ /*If the success message is to be displayed*/
                $.colorbox.resize({ innerHeight: "386px" });
                $("shopping-cart-container").attr("height","386px");
            }
        }

</script>


<!-- begin olark code -->
<script data-cfasync="false" type='text/javascript'>/*{literal}<![CDATA[*/window.olark||(function(c){var f=window,d=document,l=f.location.protocol=="https:"?"https:":"http:",z=c.name,r="load";var nt=function(){
        f[z]=function(){
            (a.s=a.s||[]).push(arguments)};var a=f[z]._={
        },q=c.methods.length;while(q--){(function(n){f[z][n]=function(){
                    f[z]("call",n,arguments)}})(c.methods[q])}a.l=c.loader;a.i=nt;a.p={
            0:+new Date};a.P=function(u){
            a.p[u]=new Date-a.p[0]};function s(){
            a.P(r);f[z](r)}f.addEventListener?f.addEventListener(r,s,false):f.attachEvent("on"+r,s);var ld=function(){function p(hd){
                hd="head";return["<",hd,"></",hd,"><",i,' onl' + 'oad="var d=',g,";d.getElementsByTagName('head')[0].",j,"(d.",h,"('script')).",k,"='",l,"//",a.l,"'",'"',"></",i,">"].join("")}var i="body",m=d[i];if(!m){
                return setTimeout(ld,100)}a.P(1);var j="appendChild",h="createElement",k="src",n=d[h]("div"),v=n[j](d[h](z)),b=d[h]("iframe"),g="document",e="domain",o;n.style.display="none";m.insertBefore(n,m.firstChild).id=z;b.frameBorder="0";b.id=z+"-loader";if(/MSIE[ ]+6/.test(navigator.userAgent)){
                b.src="javascript:false"}b.allowTransparency="true";v[j](b);try{
                b.contentWindow[g].open()}catch(w){
                c[e]=d[e];o="javascript:var d="+g+".open();d.domain='"+d.domain+"';";b[k]=o+"void(0);"}try{
                var t=b.contentWindow[g];t.write(p());t.close()}catch(x){
                b[k]=o+'d.write("'+p().replace(/"/g,String.fromCharCode(92)+'"')+'");d.close();'}a.P(2)};ld()};nt()})({
    loader: "static.olark.com/jsclient/loader0.js",name:"olark",methods:["configure","extend","declare","identify"]});
/* custom configuration goes here (www.olark.com/documentation) */
olark.identify('5962-702-10-7739');/*]]>{/literal}*/

//Test Account:
//olark.identify('2062-565-10-1508');/*]]>{/literal}*/
olark('api.box.hide');
$("#livehelp-contactus-panel").hide();
document.getElementById('livehelp-contactus-panel').innerHTML='<div id="div-livehelp" class="wy-button wy-livehelp-contactus-button wy-font-level-3 buy-button wy-left wy-center-text" onclick="show()"><div id="livehelp-icon" class="wy-left wy-img-button"></div><div class="wy-left wy-white wy-really-really-small-negative-top-margin">Live Help</div></div><a href="#email-form-container" class="cBoxElement"><div id="div-contactus" class="wy-button wy-livehelp-contactus-button wy-font-level-3 buy-button wy-right wy-center-text" onclick=setEmailFormParameters(\'SQLyog\',\'support\'); ><div id="contactus-icon" class="wy-left wy-img-button"></div><div class="wy-left wy-white wy-really-really-small-negative-top-margin">Write to us</div></div></a>';
$("#div-livehelp").hide();


var flag=0;
if(flag==0) {
    olark('api.chat.onOperatorsAway', function() {
        $("#div-livehelp").hide();
        flag++;
    });
    $("#livehelp-contactus-panel").show('medium');
}

</script>
<noscript><a href="https://www.olark.com/site/5962-702-10-7739/contact" title="Contact us" target="_blank">Questions? Feedback?</a> powered by <a href="http://www.olark.com?welcome" title="Olark live chat software">Olark live chat software</a></noscript>
<!-- end olark code -->
<script type="text/javascript">
olark('api.box.onShrink', function() {
    olark('api.box.hide');
    $("#livehelp-contactus-panel").show('medium');

});

olark('api.chat.onOperatorsAway', function() {
    $("#div-livehelp").hide("medium");
    olark('api.visitor.getDetails', function(details){
        if (details.isConversing) {
            olark('api.box.shrink');
        } else {
            olark('api.box.hide');
            $("#livehelp-contactus-panel").show('medium');
        }
    });
});


olark('api.chat.onOperatorsAvailable', function() {
    olark('api.box.hide');
    $("#livehelp-contactus-panel").show('medium');
    $("#div-livehelp").show("medium");

});

olark('api.chat.onMessageToVisitor', function(event) {
    $("#livehelp-contactus-panel").hide('medium');
});

function show() {
    $("#livehelp-contactus-panel").hide('medium',function(){
        olark('api.box.expand');
    });
}

function checkOffset() {
    var a=$(document).scrollTop()+$(window).height();

    var b=$('#wy-footer-wrapper').offset().top;

    //        alert("got to checkoffset"+a+","+b);
    if(b==0){
        //        alert("returning since footer's offset is coming as 0");
        window.setTimeout(function(){checkOffset();},10);
        return;
    }

    if (a<b) {
        //        alert("a is less than b"+a+","+b);
        $('#livehelp-contactus-panel').css('bottom', '0px');
    } else {
        //        alert("a is greater than or equal to b"+a+","+b);
        $('#livehelp-contactus-panel').css('bottom', (0+(a-b))+'px');
    }
}

var jqxhr = null;
var spinnerTarget = null;
var spinner = null;
var customerEmail = null;
$(window).load(function(){
    
    $('.card-number').keyup(function(event){
        var oldVal=this.value;
        var newVal=this.value.replace(/[^0-9]/g,'');
        if(oldVal!=newVal){
            this.value=newVal;
        }
        var card_number=$(event.target).val();
        setCardType(card_number);
    });
    $('.card-number').keypress(function(event){
        var codeTyped=event.charCode?event.charCode:event.keyCode;
        var typed=$.trim(String.fromCharCode(codeTyped));
        var card_number=$(event.target).val()+typed;
        if((codeTyped==32)||(typed.length>0&&typed!='v'&&typed!='c'&&typed!='x'&&typed.search(/[A-Za-z\s]/)!=-1))

        {
            event.preventDefault();
            if(card_number.length==0)

            {
                $('#card_type .creditcard').removeClass('inactive');
            }
            return false;
        }
        setCardType(card_number);
    });

    $("#webshop").click(function(){
        window.location = '/shop';
    });

    checkOffset();
    /* Here we set the Stripe publishable key, its needed by the Stripe.js to create cc token */
    Stripe.setPublishableKey('pk_live_2i7cbS4FyWknH4lUeZZwsdMk');
    $("#purchase_email").blur(function(){
        customerEmail = $("#purchase_email").val();
        if(customerEmail !='') {
            $("#email_error").text('');
        }
    });

    /* Month to year field switch function */
    $('.card-expiry-month').keypress(
    function(event){
        var charCode=event.charCode?event.charCode:event.keyCode;
        var typed=String.fromCharCode(charCode);
        if(typed.search(/[^0-9]/)!=-1) {
            return;
        }
        var curLength=$.trim($('.card-expiry-month').val()).length;
        if((curLength+typed.length)==2)
        {
            setTimeout(function(){
                $('.card-expiry-year').focus();
            },10);
        }
    });

    /* Here we validate the form before sending Stripe to craete cc token and display errors if any
     * on success its calls stripeResponseHandler function to charge the CC */
    $("#paymentButton").click(function(event) {
        // disable the submit button to prevent repeated clicks
        //        allowReview = false;
        customerEmail = $("#purchase_email").val();
        $(".payment-errors").text('');
        
        disableCCDetailsForm();
        spinner = $("#payment-section").spin("large", "#1D75D6");
        var isCardValid = Stripe.validateCardNumber($('.card-number').val());
        var isCVCValid = Stripe.validateCVC($('.card-cvc-number').val());
        var isExpiryValid = Stripe.validateExpiry($('.card-expiry-month').val(), $('.card-expiry-year').val());
        if(isCardValid && isExpiryValid && isCVCValid) {
            setColorboxDimensions(3, false, 0, false);
            Stripe.createToken({
                number: $('.card-number').val(),
                cvc: $('.card-cvc-number').val(),
                exp_month: $('.card-expiry-month').val(),
                exp_year: $('.card-expiry-year').val()
            }, stripeResponseHandler);
        } else if(isCardValid == false){
            $("#payment-section").spin(false);
            enableCCDetailsForm();
            setColorboxDimensions(3, false, 0, true);
            $(".payment-errors").text('Please enter valid credit card number');
        } else if(isExpiryValid == false){
            $("#payment-section").spin(false);
            enableCCDetailsForm();
            setColorboxDimensions(3, false, 0, true);
            $(".payment-errors").text('Please enter a valid expiry');
        } else if(isCVCValid == false){
            $("#payment-section").spin(false);
            enableCCDetailsForm();
            setColorboxDimensions(3, false, 0, true);
            $(".payment-errors").text('Please enter valid cvv/cvc number');
        } 
    });

    /* This function used to return false in case any ajax error is found for stripe payment */
    $(document).ajaxError(function(event, jqxhr, settings, exception) {
        //console.log(exception);
        //console.log(settings);
        return false;
    });
});

$(window).scroll(checkOffset);

/* This function used to set the card icon as he types the card number like Visa, Mastercard etc */
function setCardType(card_number){
    var card_type=Stripe.cardType(card_number).toLowerCase();
    card_type=card_type.split(' ');
    card_type=card_type[0];
    if(card_type=='unknown')

    {
        $('#card_type .creditcard').removeClass('inactive');
        return true;
    }
    $('#card_type .creditcard').addClass('inactive');
    $('#card_type .'+card_type).removeClass('inactive');
};

/* This function used to disable the payment form */
function disableCCDetailsForm() {
    $('#purchase_email').attr("readonly", "readonly");
    $('.card-number').attr("readonly", "readonly");
    $('.card-cvc-number').attr("readonly", "readonly");
    $('.card-expiry-month').attr("readonly", "readonly");
    $('.card-expiry-year').attr("readonly", "readonly");
    $('#paymentButton').attr("disabled", "disabled");
    $('#paymentButton').addClass("disabled");
    $('.edit-icon').addClass("desaturate");
    $('#edit-order-text').addClass("wy-multiyear-text");
    allowReview=false;
}

/* This function used to enable the disabled payment form */
function enableCCDetailsForm() {
    $('#purchase_email').removeAttr("readonly");
    $('.card-number').removeAttr("readonly");
    $('.card-cvc-number').removeAttr("readonly");
    $('.card-expiry-month').removeAttr("readonly");
    $('.card-expiry-year').removeAttr("readonly");
    $('#paymentButton').removeClass("disabled");
    $("#paymentButton").removeAttr("disabled");
    $('.edit-icon').removeClass("desaturate");
    $('#edit-order-text').removeClass("wy-multiyear-text");
    allowReview=true;
}

/*
 * This function send the ecommerce transaction details to google analytics servers
 * 
 * PARAMETERS: 
 * @txnid: The transaction id returned by payment processor currently stripe
 * 
 * SOURCE of Products ITEMS:
 * @Shopping Cart cookie and @discount cookie
 */
function trackTransByGA($txnid){
        
    $amount=0;
    $discount=0; 
    
    
    $bcart=JSON.parse($.cookie('shopping_cart'));
    
    
    
    for($i=0;$i<$bcart.length;$i++)
    {
        $item=$bcart[$i];
        $amount=$amount+ $item.amount*$item.quantity;
   
    }
    
    //console.log("amount : "+$amount);
    if(typeof $.cookie("discount") !== "undefined" && $.cookie("discount"))
    {
        $dis=JSON.parse($.cookie('discount'));
        $discount=$dis.value;
    }
    // console.log("discount: "+$discount);
    //console.log("after: discount " + (parseInt($amount)- parseInt($discount)));
    _gaq.push(['_addTrans',
        $txnid ,           // transaction ID - required
        'Webyog Softworks Ltd', // affiliation or store name
        (parseInt($amount)-parseInt($discount)),          // total - required
        0,           // tax
        0,          // shipping
        'Bangalore',       // city
        'KA',     // state or province
        'INDIA'             // country
    ]);
    

    //console.log($txnid);

    for($i=0;$i<$bcart.length;$i++)
    {
        $item=$bcart[$i];
        if($item.item_name.toLowerCase().indexOf("combo")<0)
        {$productCategory=$item.item_name.split(' ')[0];
            //console.log("here");
        }
        else
        {$productCategory="Combo";
            //console.log($item.item_name.toLowerCase().indexOf("combo"));    
        }
    
        if($item.productMultiyear=='3')
            $sku= $item.item_number+"Y"+"5"+"-";
        else
            $sku= $item.item_number+"Y"+$item.productMultiyear+"-";
        
        if($item.purchaseType=='new')
        {$sku=$sku+'N';
            $productCategory=$productCategory+" - New";
        }
        else{
            $sku=$sku+'U';
            $productCategory=$productCategory+" - Upgrade";    
        }
        // console.log($i+") "+$sku+"-->"+JSON.stringify($item));
        _gaq.push(['_addItem',
            $txnid,           // transaction ID - necessary to associate item with transaction
            $sku,           // SKU/code - required
            $item.item_name,        // product name
            $productCategory,   // category or variation
            $item.amount,          // unit price - required
            $item.quantity               // quantity - required
        ]);
       
    }
    //for tracking discount as an product
    if(typeof $.cookie("discount") !== "undefined" && $.cookie("discount"))
    {
        $dis=JSON.parse($.cookie('discount'));
        $discount=$dis.value;
        _gaq.push(['_addItem',
            $txnid,           
            $dis.code,           
            "Discount",        
            $dis.type,   
            (-1*parseInt($dis.value)),     
            "1"              
        ]);
    }
    
    
    _gaq.push(['_trackTrans']);
    _gaq.push(['_trackPageview','/Payment-Success']);
    _gaq.push(['_trackEvent', 'Success', 'Purchase', $txnid,(parseInt($amount)-parseInt($discount))]);
    checkoutBtnClick=0;
    
}

/* This function sends the cc token for  charging the amount to server
 * If any error found while charging cc it displays inline on the popup, It also disable the form while
 * posting the data to server and enables it if success or error msg is displayed.
 * If success shows the payment success page
 * */
function stripeResponseHandler(status, response) {
    //console.log(response);
    if (response.error) {
        //console.log(response.error);
        // show the errors on the form
        $("#payment-section").spin(false);
        setColorboxDimensions(3, false, 0, true);
        switch(response.error.param) {
            case 'exp_year':
                $(".payment-errors").text('Please enter a valid year');
                break;
            case 'exp_month':
                $(".payment-errors").text('Please enter a valid month');
                break;
            case 'number':
                $(".payment-errors").text('Please enter valid credit card number');
                break;
            default:
                $(".payment-errors").text(response.error.message);
                break;
        }

        enableCCDetailsForm();
    } else {
        setColorboxDimensions(3, false, 0, false);
        // token contains id, last4, and card type
        var formData = $("#checkoutForm").serializeFormJSON();
        var token = response['id'];
        var phone_no = $('#phone_no').val();
        var jqxhr = $.post("/shoppingcart/payment", { 'stripeToken': token, 'cartItems':formData, 'customer_email':customerEmail ,'phone': phone_no},
        function(data) {
            //data = JSON.parse(data);
            if(data.status == 'success') {
                enableCCDetailsForm();
                $('#card_type .creditcard').removeClass('inactive');
                $("#payment-section").spin(false);
                $("#search").watermark("Search",{className:"wy-watermark", useNative:false});
                customerId=data.customer_id;
                $("#customer-fname").watermark("Optional",{className:"wy-watermark", useNative:false});
                $("#customer-lname").watermark("Optional",{className:"wy-watermark", useNative:false});
                $("#customer-phone").watermark("Optional",{className:"wy-watermark", useNative:false});
                $("#customer-fname").val(data.first_name);
                $("#customer-lname").val(data.last_name);
                $("#customer-phone").val(data.phone);
                
                //console.log("Data Loaded: " + data);
                trackTransByGA(data["txnid"]);
                showOption(-2, false)
            } else {
                $("#payment-section").spin(false);
                enableCCDetailsForm();
                setColorboxDimensions(3, false, 0, true);
                if(data.error.type == 'card_error') {
                    if(data.error.code == 'card_declined') {
                        $(".payment-errors").text('The card you are trying to use has been declined, please try with another card');
                    } else if(data.error.code == 'expired_card') {
                        $(".payment-errors").text("The card you are trying to use has expired, please try with another card");
                    } else if(data.error.code == 'processing_error') {
                        $(".payment-errors").text("There was an error while processing your payment, please try again");
                    } else {
                        $(".payment-errors").text('The card you are trying to use has been declined, please try with another card');
                    }
                } else if(data.error.type == 'customer') {
                    $(".payment-errors").text(data.error.message);
                } else if(data.error.type == 'amount_limit_exceed') {
                    $(".payment-errors").html(data.error.message);
                } else if(data.error.type == 'empty_token') {
                    $(".payment-errors").html(data.error.message);
                }else {
                    $(".payment-errors").text('Oops! An error has occured while processing your card, Please contact us at sales@webyog.com');
                }
                    
            }
        })
    }
}
/* This function validates the email */
function validateEmail(email) {
    var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
    return emailReg.test(email);
}

function trackCheckoutButtonClick() {
    try {
        var data = {
            cart_details: $("#checkoutForm").serializeFormJSON(),
            reg_name: $.trim($("#regname").val()),
            phone_number: $('#phone_no').val(),
            customer_email: customerEmail
        };

        $.post('/analytics/cart_checkout_tracking', data);
    }
    catch(ignore)
    {

    }
}

</script>            <script type="text/javascript" src="https://static.webyog.com/min/g=master-js&v=242"></script>
            <script type="text/javascript">

                function formatTitle(title, currentArray, currentIndex, currentOpts) {
                    return '<div id="tip7-title"><span><a href="javascript:;" onclick="$.fancybox.close();">Close</a></span>' + (title && title.length ? '<b>' + title + '</b>' : '' ) + 'Image ' + (currentIndex + 1) + ' of ' + currentArray.length + '</div>';
                }
            </script>
        </div>
    </body>
</html>
